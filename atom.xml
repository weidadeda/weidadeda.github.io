<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://weidadeda.github.io</id>
    <title>Gridea</title>
    <updated>2022-02-10T02:29:36.002Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://weidadeda.github.io"/>
    <link rel="self" href="https://weidadeda.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://weidadeda.github.io/images/avatar.png</logo>
    <icon>https://weidadeda.github.io/favicon.ico</icon>
    <rights>All rights reserved 2022, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[Cç«¯H5æˆ–å°ç¨‹åºå¸¸è§é—®é¢˜æ€»ç»“]]></title>
        <id>https://weidadeda.github.io/post/c-duan-h5-huo-xiao-cheng-xu-chang-jian-wen-ti-zong-jie</id>
        <link href="https://weidadeda.github.io/post/c-duan-h5-huo-xiao-cheng-xu-chang-jian-wen-ti-zong-jie">
        </link>
        <updated>2022-02-09T07:59:28.000Z</updated>
        <content type="html"><![CDATA[<h3 id="1éƒ¨åˆ†æœºå‹æ‹ç…§ä¸Šä¼ å›¾ç‰‡æ—‹è½¬é—®é¢˜">1.éƒ¨åˆ†æœºå‹æ‹ç…§ä¸Šä¼ å›¾ç‰‡æ—‹è½¬é—®é¢˜ï¼š</h3>
<p>ç›´æ¥ä»å›¾ç‰‡åé¢åŠ å‚æ•°â€˜?x-oss-process=image/auto-orient,1/resize,m_fixedâ€™ï¼ˆåŠ ä¸Šå‚æ•°ä¹‹åä¼šè‡ªåŠ¨æ—‹è½¬å›æ¥ï¼Œå…¶ä»–å‚æ•°å¯å‚è€ƒé˜¿é‡ŒOSSå®˜æ–¹æ–‡æ¡£https://help.aliyun.com/document_detail/44691.html?spm=a2c4g.11186623.6.1390.750ac1f6HTe92Qï¼‰</p>
<h3 id="2swiper3dä¸¤è¾¹ç•™ç™½æ•ˆæœ">2.swiper3Dä¸¤è¾¹ç•™ç™½æ•ˆæœï¼š</h3>
<p>ï¼ˆå°ç¨‹åºh5å‡é€‚ç”¨ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»ç»™swiperçˆ¶çº§å…ƒç´ åŠ overflow-x:hidden</p>
<pre><code>.swiper-container {
  height: 100%;
  width: 600px;
  perspective: 1600px;
  overflow: visible;
  img {
    width: 100%;
    height: 720px;
    border-radius: 20px;
  }
}
.swiper-slide {
  padding: 0 24px;
  box-sizing: border-box;
  text-align: center;
  transition: transform 0.5s;
  transform-origin: 50% 50%;
  transform: scale(0.9);
  &amp;.swiper-slide-active {
    transform: scale(1);
  }
}
</code></pre>
<h3 id="3å°ç¨‹åºçš„è·³è½¬åå±‚é™åˆ¶ä¸è¦ä¸€ç›´ç”¨navigatetoè¿™æ ·å±äºä¸€ç›´å‰è¿›å¦‚æœéœ€è¦è·³è½¬å›é¦–é¡µæˆ–è€…å…¶ä»–å¯ä»¥ä½¿ç”¨relaunché€»è¾‘å¤æ‚æ—¶å¯è‡ªå·±å†™é¡¶éƒ¨å¯¼èˆªæ åŒ…æ‹¬è¿”å›æŒ‰é’®">3.å°ç¨‹åºçš„è·³è½¬åå±‚é™åˆ¶ï¼Œä¸è¦ä¸€ç›´ç”¨navigateToï¼Œè¿™æ ·å±äºä¸€ç›´å‰è¿›ï¼Œå¦‚æœéœ€è¦è·³è½¬å›é¦–é¡µæˆ–è€…å…¶ä»–å¯ä»¥ä½¿ç”¨reLaunchï¼Œé€»è¾‘å¤æ‚æ—¶å¯è‡ªå·±å†™é¡¶éƒ¨å¯¼èˆªæ åŒ…æ‹¬è¿”å›æŒ‰é’®ã€‚</h3>
<h3 id="4ä¿å­˜æµ·æŠ¥åˆ°æœ¬åœ°æ¨èä¸€æ³¢ç”Ÿæˆå°ç¨‹åºæµ·æŠ¥çš„æ’ä»¶éå¸¸ç®€å•æ–¹ä¾¿">4.ä¿å­˜æµ·æŠ¥åˆ°æœ¬åœ°ï¼šæ¨èä¸€æ³¢ç”Ÿæˆå°ç¨‹åºæµ·æŠ¥çš„æ’ä»¶ï¼Œéå¸¸ç®€å•æ–¹ä¾¿</h3>
<p>taro-plugin-canvas (Taroç¯å¢ƒä½¿ç”¨)ä¸wxa-plugin-canvasï¼ˆæ™®é€šå°ç¨‹åºä½¿ç”¨ï¼‰<br>
tip:å¦‚æœé‡åˆ°éå¸¸è§„çš„æƒ…å†µï¼Œéœ€è¦æ‰‹å†™canvaså¹¶ä¸”å®½é«˜å°ºå¯¸ä¹˜2ä¿è¯æ¸…æ™°åº¦ã€‚</p>
<h3 id="5inputå…‰æ ‡æ°¸è¿œåœç•™åœ¨æœ€å">5.inputå…‰æ ‡æ°¸è¿œåœç•™åœ¨æœ€åï¼š</h3>
<pre><code>var el = document.getElementById(&quot;IPTname&quot;);
var range = document.createRange();
range.selectNodeContents(el);
range.collapse(false);
var sel = window.getSelection();
sel.removeAllRanges();
sel.addRange(range);
</code></pre>
<h3 id="6å°ç¨‹åºè·å–ç”¨æˆ·æˆæƒç”¨æˆ·ä¿¡æ¯ç”¨æˆ·å®šä½ç”¨æˆ·ç›¸å†Œè®¿é—®æƒé™ç­‰æ—¶éœ€è¦å¤„ç†æ‹’ç»æ—¶çš„æƒ…å†µ-ç”Ÿæˆæµ·æŠ¥åˆ°è‡ªå·±ç›¸å†Œçš„æ—¶å€™å¦‚æœç”¨æˆ·åœ¨æˆæƒçš„æ—¶å€™ç‚¹å‡»äº†æ‹’ç»å¦‚æœä¸å…¼å®¹æ‹’ç»æˆæƒåˆ™ç›´æ¥ç”Ÿæˆå¤±è´¥">6.å°ç¨‹åºè·å–ç”¨æˆ·æˆæƒï¼ˆç”¨æˆ·ä¿¡æ¯/ç”¨æˆ·å®šä½/ç”¨æˆ·ç›¸å†Œè®¿é—®æƒé™ç­‰ï¼‰æ—¶éœ€è¦å¤„ç†æ‹’ç»æ—¶çš„æƒ…å†µã€‚ç”Ÿæˆæµ·æŠ¥åˆ°è‡ªå·±ç›¸å†Œçš„æ—¶å€™å¦‚æœç”¨æˆ·åœ¨æˆæƒçš„æ—¶å€™ç‚¹å‡»äº†æ‹’ç»ï¼Œå¦‚æœä¸å…¼å®¹æ‹’ç»æˆæƒåˆ™ç›´æ¥ç”Ÿæˆå¤±è´¥ã€‚</h3>
<h3 id="7ç›‘å¬ç§»åŠ¨ç«¯é”®ç›˜å¼¹å‡ºå’Œæ”¶èµ·äº‹ä»¶">7.ç›‘å¬ç§»åŠ¨ç«¯é”®ç›˜å¼¹å‡ºå’Œæ”¶èµ·äº‹ä»¶ã€‚</h3>
<p>åœ¨iosè®¾å¤‡ä¸Š,æ“ä½œè¡¨å•è¾“å…¥æ—¶,é”®ç›˜å¼¹å‡ºæ—¶ä¼šæŠŠé¡µé¢é¡¶èµ·æ¥,é”®ç›˜æ”¶èµ·æ—¶å¹¶ä¸ä¼šæŠŠé¡µé¢æ¢å¤æˆåŸæ¥çš„æ ·å­,é€ æˆé¡µé¢æ ·å¼é”™ä¹±,åˆ©ç”¨focusoutå’Œfocusinäº‹ä»¶,å¯ä»¥é—´æ¥åœ°ç›‘å¬åˆ°é”®ç›˜çš„æ”¶èµ·å’Œå¼¹å‡ºäº‹ä»¶,ç„¶åæ“ä½œé¡µé¢æ»šåŠ¨åˆ°æƒ³è¦çš„ä½ç½®.</p>
<p>focusoutè§¦å‘æ—¶æœº:  å½“å…ƒç´ å³å°†å¤±å»ç„¦ç‚¹æ—¶ï¼Œfocusout äº‹ä»¶è¢«è§¦å‘ã€‚focusout äº‹ä»¶å’Œ blur äº‹ä»¶ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºåè€…ä¸ä¼šå†’æ³¡ã€‚</p>
<p>focusinè§¦å‘æ—¶æœº:    å½“å…ƒç´ å³å°†æ¥æ”¶ focus äº‹ä»¶æ—¶ï¼Œfocusin äº‹ä»¶è¢«è§¦å‘ã€‚ è¿™ä¸ªäº‹ä»¶å’Œ focus äº‹ä»¶çš„ä¸»è¦åŒºåˆ«åœ¨äºåè€…ä¸ä¼šå†’æ³¡ã€‚</p>
<p>ç›‘å¬æ–¹å¼:</p>
<pre><code>let scrollTop = 0
//é”®ç›˜æ”¶èµ·
document.body.addEventListener('focusout',()=&gt;{
   document.body.scrollTop=document.documentElement.scrollTop=scrollTop
})
//é”®ç›˜å¼¹å‡º
document.body.addEventListener('focusin',()=&gt;{
   scrollTop = document.body.scrollTop || document.documentElement.scrollTop
})
</code></pre>
<h3 id="8ç§»åŠ¨ç«¯ä»£ç è¿”å›ä¸Šä¸€é¡µwindowlocationbackå¤±æ•ˆ">8.ç§»åŠ¨ç«¯ä»£ç è¿”å›ä¸Šä¸€é¡µï¼ˆwindow.location.back()å¤±æ•ˆï¼‰</h3>
<p>å°¼ç›ã€‚ã€‚ç§»åŠ¨ç«¯è¿”å›ä¸Šä¸€é¡µæœ‰æ—¶å€™ç”¨window.location.back()ä¸å¥½ä½¿ï¼Œæ— è§£ã€‚å¯ä»¥ä½¿ç”¨window.location.href = document.referrerã€‚</p>
<h3 id="9å•é¡µé¢åº”ç”¨è·³è½¬è·¯ç”±ä¹‹åå†æ¬¡ä½¿ç”¨echartsæ—¶ä¸å±•ç¤º">9.å•é¡µé¢åº”ç”¨è·³è½¬è·¯ç”±ä¹‹åå†æ¬¡ä½¿ç”¨echartsæ—¶ä¸å±•ç¤º</h3>
<p>é¦–æ¬¡ä½¿ç”¨ä¸å±•ç¤ºï¼Œå¯ä»¥å»¶è¿ŸåŠ è½½ï¼Œä½†æ˜¯å½“è·¯ç”±è·³è½¬å›æ¥ä¹‹åå»¶è¿Ÿéƒ½ä¸ç®¡ç”¨ï¼Œé‚£ä¹ˆéœ€è¦åœ¨init Echartsä¹‹å‰åŠ¨æ€è®¾ç½®å®¹å™¨å®½é«˜ï¼Œå¹¶ä¸”æ¸…ç©ºçˆ¶å…ƒç´ ï¼Œå› ä¸ºå†æ¬¡å›æ¥çš„æ—¶å€™ä¹‹å‰çš„echartså®ä¾‹å·²ç»æ˜¯å­˜åœ¨çš„äº†ï¼Œå¯åœ¨è°ƒè¯•ä¸­æŸ¥çœ‹è¯¦æƒ…ã€‚</p>
<h3 id="10-è§†é¢‘é»‘è¾¹é—®é¢˜">10. è§†é¢‘é»‘è¾¹é—®é¢˜</h3>
<p>ç»™videoæ ‡ç­¾ï¼ˆåŸç”Ÿvideoæ ‡ç­¾ï¼‰åŠ ä¸€ä¸ªobject-fit:fillå±æ€§å³å¯è§£å†³ã€‚è¦å¼ºè°ƒçš„æ˜¯ï¼Œåƒä¸‡ä¸è¦ä½¿ç”¨Taroçš„Videoæ ‡ç­¾ï¼Œå¾ˆå‘ï¼Œè§£å†³äº†é»‘è¾¹ï¼Œå…¨å±æ—¶åˆä¼šå¯¼è‡´è§†é¢‘å˜å½¢ï¼Œä¸ç”¨object:fillçš„è¯ä¹Ÿèƒ½è§£å†³é»‘è¾¹ï¼Œä½†æ˜¯å…¨å±æ—¶è§†é¢‘çš„é€€å‡ºå…¨å±æ ·å¼åˆä¼šè¢«è¦†ç›–ã€‚</p>
<h3 id="11-æ‰‹æœºé”å±æ—¶å€’è®¡æ—¶åœæ­¢">11. æ‰‹æœºé”å±æ—¶å€’è®¡æ—¶åœæ­¢</h3>
<pre><code>window.addEventListener('visibilitychange',() =&gt; {
   if (
     //hiddenä¸ºé”å±æ—¶æˆ–é¡µé¢ä¸å±•ç¤ºæ—¶ï¼Œå¯é‡æ–°è·å–æ—¶é—´å¼€å§‹å€’è®¡æ—¶ã€‚
      document.visibilityState =='hidden'
   ) 
})
</code></pre>
<h3 id="12ç§»åŠ¨ç«¯å®ç°çœ-å¸‚-åŒº-è¡—é“å››çº§è”åŠ¨">12.ç§»åŠ¨ç«¯å®ç°çœ-å¸‚-åŒº-è¡—é“å››çº§è”åŠ¨</h3>
<p>éœ€æ±‚æ˜¯è¦å®ç°åœ°åŒºå››çº§è”åŠ¨ï¼Œä½†æ˜¯vantçš„æ’ä»¶åªæ”¯æŒä¸‰çº§åœ°åŒºè”åŠ¨ï¼Œå°±å¾ˆå°´å°¬ï¼Œåªèƒ½è‡ªå·±å†™ï¼Œä½†æ˜¯è‡ªå·±å†™çš„è¯UIä¸äº¤äº’ä½“éªŒä¼šå¾ˆå·®ï¼Œæ‰€ä»¥å°±æƒ³åŠæ³•å»å’Œåç«¯å¯¹æ¥ã€‚å…¶å®å¾ˆç®€å•ï¼Œå†™å‡ºæ¥åªæ˜¯æé†’å¤§å®¶å¯ä»¥è¿™ä¹ˆå®ç°ï¼Œå‡å°‘æ€è€ƒä¸è¸©å‘çš„æ—¶é—´ã€‚ä¸‰çº§è”åŠ¨é€‰æ‹©å®Œä¹‹åä¼šè¿”å›åœ°åŒºç¼–ç ï¼Œeg:Array&lt;{code:'110101',name:'ä¸œåŸåŒº'}&gt;,ç„¶åå»è¯·æ±‚åç«¯çš„æ¥å£å°†åœ°åŒºç¼–ç ä¼ è¿‡å»ï¼Œå°±èƒ½å¾—åˆ°å…¶è¡—é“çš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶åç®€å•è¿‡æ»¤ä¸€ä¸‹ï¼Œæ”¾åœ¨Pickeré€‰æ‹©å™¨ä¸­å°±å¯ä»¥å®ç°ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥å†™ä¸šåŠ¡é€»è¾‘äº†ã€‚</p>
<h3 id="13ioså†…webviewä¸­vueé¡¹ç›®ä¼šå‡ºç°å¤§å—ç™½è‰²é®ç½©">13.ioså†…webviewä¸­vueé¡¹ç›®ä¼šå‡ºç°å¤§å—ç™½è‰²é®ç½©</h3>
<p>é—®é¢˜æè¿°ï¼š</p>
<p>Aé¡µé¢â€”â€”&gt;Bé¡µé¢â€”â€”&gt;iosè‡ªå¸¦çš„è¿”å›â€”â€”&gt;ç™½å±å‡ºç°(åƒä¸ªé­”é¬¼)â€”â€”&gt;ç‚¹å‡»æˆ–æ»‘åŠ¨é¡µé¢â€”â€”&gt;é—®é¢˜è§£å†³</p>
<p>åŸå› æ˜¯ï¼Œç»è¿‡æ’æŸ¥ï¼Œå‘ç°åœ¨ios æœºå™¨ä¸Šä½¿ç”¨webview å¼€å‘Vueé¡¹ç›®æ—¶å€™ï¼Œgo history (-1)ï¼Œæ— æ³•å°†body çš„é«˜åº¦æ‹‰æ‰ï¼Œä½¿å¾—é®ä½ï¼Œè§¦å‘è½»ç‚¹å‡»ï¼Œæ–¹å¯æ¶ˆé™¤è¯¥é®ç½©</p>
<p>è§£å†³çš„ç†è®ºï¼šç”¨äºæœ€é‡è¦çš„html å®¹å™¨æ˜¯containerï¼Œç„¶è€Œå› ä¸ºè®¾ç½®htmlã€bodyé«˜åº¦æ˜¯100%ï¼Œä»è€Œé€ æˆäº† container æ’‘å¼€çˆ¶çº§ï¼Œä½†æµè§ˆå™¨é»˜è®¤æ»šåŠ¨çš„scroll å¹¶ä¸æ˜¯ containerï¼Œè€Œæ˜¯bodyï¼ŒæŸäº›å› ç´ ï¼Œé€ æˆè¿”å›history åï¼Œæ— æ³•å¤åŸï¼ˆios çš„é”…ï¼‰ï¼Œä¸ºæ­¤ï¼Œå°† container(app.vueä¸­åŒ…è£¹çš„divï¼Œä¹Ÿå¯ä»¥æ˜¯#app) è¿›è¡Œäº†ç»å¯¹å®šä½ï¼Œå¹¶è®©å®ƒé‡æ–°æˆä¸º scroll çš„å¯¹è±¡ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚</p>
<pre><code>html, body {

 width: 100%;

 height: 100%;
 min-height: 100vh;

 margin: 0;

 padding: 0;

 position: relative;

}

.container {

 width: 100%;

height: 100vh;
 min-height: 100vh;

 background: #fff;

 overflow: scroll;

 -webkit-overflow-scrolling: touch;

 position: absolute;

 left:0;

 top:0;

}
</code></pre>
<h3 id="14åœ¨iosä¸Šaé¡µé¢åˆ†äº«æœ‹å‹åœˆä¹‹åè·³è½¬åˆ°-b-é¡µé¢æˆ–è¿›è¡Œåˆ«çš„æ“ä½œ">14.åœ¨iosä¸ŠAé¡µé¢åˆ†äº«æœ‹å‹åœˆä¹‹åï¼Œè·³è½¬åˆ° B é¡µé¢ï¼ˆæˆ–è¿›è¡Œåˆ«çš„æ“ä½œï¼‰</h3>
<p>æ³¨ï¼šç¦»å¼€ appçš„ A é¡µé¢å»å¾®ä¿¡ï¼Œå†æ¬¡å›åˆ° app çš„æ—¶å€™è·³è½¬åˆ° B é¡µé¢</p>
<p>visibilitychangeï¼šå½“ç”¨æˆ·æœ€å°åŒ–çª—å£æˆ–è€…åˆ‡æ¢é€‰é¡¹å¡çš„æ—¶å€™ï¼Œapi å°±ä¼šå‘é€visibilitychangeäº‹ä»¶ï¼Œè®©å¼€å‘è€…çŸ¥é“é¡µé¢çŠ¶æ€å·²æ›´æ”¹ã€‚ä½ å¯ä»¥æ£€æµ‹äº‹ä»¶å¹¶æ‰§è¡ŒæŸäº›æ“ä½œæˆ–è¡Œä¸ºã€‚</p>
<pre><code>//è¿™ä¸ªæ–¹æ³•åœ¨åˆ†äº«è¢«è§¦å‘çš„æ—¶å€™æ‰§è¡Œ
initVisibilityChange() {
      if (typeof document.visibilityState != &quot;undefined&quot;) {
        this.visibleChange = &quot;visibilitychange&quot;;
        this.vibibleState = &quot;visibilityState&quot;;
      } else if (
        typeof (document as any).webkitVisibilityState != &quot;undefined&quot;
      ) {
        this.visibleChange = &quot;webkitvisibilitychange&quot;;
        this.vibibleState = &quot;webkitVisibilityState&quot;;
      }
      if (this.visibleChange) {
        document.addEventListener(
          this.visibleChange,
          this.onVisibilityChanged,
          false
        );
      }
    },
      /**
     * ä»å¾®ä¿¡è¿”å›appå¯ä»¥åœ¨è¿™é‡Œé¢å¤„ç†äº‹æƒ…
     */
    onVisibilityChanged(event: any) {
      var hidden = event.target.webkitHidden;
      if ((document as any)[this.vibibleState] == &quot;visible&quot;) {
          this.goRun(); // åšè‡ªå·±éœ€è¦çš„é€»è¾‘å¤„ç†
          this.removeVisibilityChange();
      }
    },
     // ç§»é™¤appåå°ç›‘å¬äº‹ä»¶
    removeVisibilityChange() {
      document.removeEventListener(
        this.visibleChange,
        this.onVisibilityChanged,
        false
      );
    },
</code></pre>
<h3 id="15-ä»vueé¡µé¢è·³è½¬åˆ°évueé¡µé¢ç‚¹å‡»è¿”å›iosè®¾å¤‡ä¸Šé¡µé¢æ•°æ®ä¸åˆ·æ–°">15. ä»vueé¡µé¢è·³è½¬åˆ°évueé¡µé¢ï¼Œç‚¹å‡»è¿”å›ï¼Œiosè®¾å¤‡ä¸Šé¡µé¢æ•°æ®ä¸åˆ·æ–°ã€‚</h3>
<p>æ¯”å¦‚Aé¡µé¢å®šä¹‰äº†ä¸€ä¸ªå˜é‡ä¸ºtrueï¼Œç‚¹å‡»è·³è½¬åˆ°évueé¡¹ç›®é¡µé¢ï¼ˆphpï¼‰ï¼Œç‚¹å‡»è¿”å›ï¼ŒæŸ¥çœ‹è¿™ä¸ªå˜é‡ï¼Œåœ¨å®‰å“ä¸Šä¾ç„¶ä¸ºtureï¼Œä½†æ˜¯åœ¨iosä¸Šå°±å˜æˆäº†falseã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<pre><code>window.onpageshow=function(e){
ã€€ã€€if(e.persisted) {
ã€€ã€€ã€€ã€€window.location.reload()
ã€€ã€€}
};
</code></pre>
<h3 id="16-appç‚¹å‡»è‡ªå¸¦è¿”å›æŒ‰é’®å…³é—­é¡µé¢ä»¥åŠç¦ç”¨è¿”å›çš„è¸©å‘è®°å½•">16. appç‚¹å‡»è‡ªå¸¦è¿”å›æŒ‰é’®å…³é—­é¡µé¢ä»¥åŠç¦ç”¨è¿”å›çš„è¸©å‘è®°å½•</h3>
<p>http://note.youdao.com/s/4qUINhV0 ï¼ˆæ¯”è¾ƒå¤šï¼Œæœ‰é“äº‘é“¾æ¥å‘å‡ºæ¥ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼‰</p>
<h3 id="17-wxchooseimageæ–¹æ³•åœ¨å®‰å“ä¸iosä¸Šå–åˆ°çš„base64æ ¼å¼ä¸ä¸€æ ·å®‰å“æ²¡æœ‰dataimagejpgbase64å‰ç¼€éœ€è¦å•ç‹¬å¤„ç†">17. wx.chooseImageæ–¹æ³•åœ¨å®‰å“ä¸iosä¸Šå–åˆ°çš„base64æ ¼å¼ä¸ä¸€æ ·ï¼Œå®‰å“æ²¡æœ‰data:image/jpg;base64å‰ç¼€ï¼Œéœ€è¦å•ç‹¬å¤„ç†</h3>
<h3 id="18-æ‰‹æœºå†…h5ç‚¹å‡»inputæ— æ³•å”¤èµ·è‡ªå¸¦é”®ç›˜å¯ä»¥ç»™inputæ·»åŠ clickäº‹ä»¶æ‰‹åŠ¨è§¦å‘focusäº‹ä»¶">18. æ‰‹æœºå†…h5ç‚¹å‡»inputæ— æ³•å”¤èµ·è‡ªå¸¦é”®ç›˜ï¼šå¯ä»¥ç»™inputæ·»åŠ clickäº‹ä»¶æ‰‹åŠ¨è§¦å‘focusäº‹ä»¶ã€‚</h3>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[jsè·å–æ–‡ä»¶å¤§å° window.performance]]></title>
        <id>https://weidadeda.github.io/post/js-huo-qu-wen-jian-da-xiao</id>
        <link href="https://weidadeda.github.io/post/js-huo-qu-wen-jian-da-xiao">
        </link>
        <updated>2022-02-07T09:49:49.000Z</updated>
        <content type="html"><![CDATA[<p>èƒŒæ™¯ï¼šä»Šå¤© æ¯å‘¨ä¾‹è¡ŒæŠ€æœ¯åˆ†äº« çš„æ—¶å€™ï¼Œæœ‰ä½åŒäº‹è¯´ js è·å–ä¸åˆ°æ–‡ä»¶å¤§å°ï¼šæµè§ˆå™¨é»˜è®¤ä¸å…è®¸js æ‰§è¡ŒIOæ“ä½œã€‚ ä¸¾äº†ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æƒ³è·å–ä¸€ä¸ªå›¾ç‰‡åœ°å€çš„æ–‡ä»¶å¤§å°ï¼Œå› ä¸ºä¹‹å‰åšè¿‡å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ‰€ä»¥æ¯”è¾ƒæ•æ„Ÿï¼Œæ„Ÿè§‰åº”è¯¥æ˜¯å¯ä»¥çš„ï¼Œè™½ç„¶ä»–è¯´ç½‘ä¸Šæ‰¾è¿‡å¾ˆå¤šèµ„æ–™ä½†æ˜¯éƒ½ä¸è¡Œï¼Œä½†æ˜¯è¿™ç§ä¸œè¥¿ åªæœ‰è‡ªå·±è¯•è¯•æ‰å®‰å¿ƒå˜›~~</p>
<h3 id="å¤±è´¥æ–¹æ¡ˆ-canvastoblob">å¤±è´¥æ–¹æ¡ˆ canvas.toBlob</h3>
<pre><code>function loadImg(url){
    return new Promise((res, rej) =&gt; {
        const img = new Image()
        img.crossOrigin = ''   // é˜²æ­¢img ç”»åœ¨canvasä¸Šæ—¶æŠ¥è·¨åŸŸé”™è¯¯
        img.onload = function() {
            res(this)
        }
        img.onerror = function() {
            rej()
        }
        img.src = url
    })
}

async function getImgSize(url) {
    const urlArr = url.split('.')
    const mime = &quot;image/&quot; + urlArr[urlArr.length-1]
    const img = await loadImg(url)
    const {width,height} = img
    const canvas = document.createElement('canvas')
    const ctx = canvas.getContext('2d');
    canvas.width = width;
    canvas.height = height;
    ctx.drawImage(img,0,0,width,height)
    canvas.toBlob(
        blob =&gt; {
            console.log(url,blob,(blob.size / 1000)+'KB')
        },
        mime
    );
}

getImgSize('https://images.daojia.com/changsha/banner/pic/25675a8d10bfa08e9599d2deb9a44eae.jpeg')
</code></pre>
<p>çœ‹æ—¥å¿—è¾“å‡º<br>
<img src="https://weidadeda.github.io/post-images/1644227403808.jpg" alt="" loading="lazy"><br>
çœ‹ç€æˆäº†ï¼Œä½†å®é™….... ä¸ æœ¬åœ° å’Œ Network å·® åä¸‡å…«åƒé‡Œ<br>
<img src="https://weidadeda.github.io/post-images/1644227440435.png" alt="" loading="lazy"><br>
<img src="https://weidadeda.github.io/post-images/1644227452558.jpg" alt="" loading="lazy"><br>
æˆ‘å°è¯•äº†å‡ ä¸ªå›¾ç‰‡,æ¯ä¸ªå›¾ç‰‡éƒ½æ¯”ä¹‹å‰è¦å¤§ï¼Œè€Œä¸”å¢å¤§ç¨‹åº¦ä¸ä¸€å®š,è¿™å—ä¼°è®¡æ˜¯canvasç”»äº†ä¸€éçš„åŸå› ã€‚ã€‚ã€‚</p>
<h3 id="å¤±è´¥æ–¹æ³•-canvastodataurl-dataurltoblob">å¤±è´¥æ–¹æ³• canvas.toDataURL + dataURLtoBlob</h3>
<pre><code>function loadImg(url){
    return new Promise((res, rej) =&gt; {
        const img = new Image()
        img.crossOrigin = ''   // é˜²æ­¢img ç”»åœ¨canvasä¸Šæ—¶æŠ¥è·¨åŸŸé”™è¯¯
        img.onload = function() {
            res(this)
        }
        img.onerror = function() {
            rej()
        }
        img.src = url
    })
}

async function getImgSize(url) {
    const urlArr = url.split('.')
    const mime = &quot;image/&quot; + urlArr[urlArr.length-1]
    const img = await loadImg(url)
    const {width,height} = img
    const canvas = document.createElement('canvas')
    const ctx = canvas.getContext('2d');
    canvas.width = width;
    canvas.height = height;
    ctx.drawImage(img,0,0,width,height);
    const blob =  dataURLtoBlob(canvas.toDataURL(mime));
    console.log(url,blob,(blob.size / 1000)+'KB')
}
function dataURLtoBlob(dataurl) {
    var arr = dataurl.split(',');
    var _arr = arr[1].substring(0,arr[1].length-2);
    var mime = arr[0].match(/:(.*?);/)[1],
        bstr =atob(_arr),
        n = bstr.length,
        u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], {
        type: mime
    });
}

getImgSize('https://images.daojia.com/changsha/banner/pic/25675a8d10bfa08e9599d2deb9a44eae.jpeg')
</code></pre>
<p>çœ‹ç»“æœâ¬‡ï¸<br>
<img src="https://weidadeda.github.io/post-images/1644227621781.jpg" alt="" loading="lazy"><br>
ã€‚ã€‚ã€‚çœ‹æ¥ä¸èƒ½èµ°canvasè¿™æ¡è·¯äº†</p>
<h3 id="æˆåŠŸæ–¹æ¡ˆ-performance">æˆåŠŸæ–¹æ¡ˆ performance</h3>
<p><img src="https://weidadeda.github.io/post-images/1644227695711.png" alt="" loading="lazy"><br>
éš¾é“çœŸçš„æ²¡æœ‰åŠæ³•äº†å˜›ï¼Ÿæˆ‘ç›¯ç€ æµè§ˆå™¨Network é™·å…¥æ²‰æ€, çªç„¶ Network èµ„æºåŠ è½½ çš„sizeåœ¨æˆ‘çœ¼é‡Œ è¶Šæ¥è¶ŠæŠ¢çœ¼ï¼Œè²Œä¼¼æœ‰ä¸ªapiå¯ä»¥è·å–åˆ°èµ„æºåŠ è½½~~~~~ èµ°èµ·</p>
<pre><code>function getImgSize(url){
    return new Promise((res, rej) =&gt; {
        var performance = window.performance || 
            window.msPerformance || 
            window.webkitPerformance;
        if (performance) {
            const img = new Image()
            img.crossOrigin = ''
            img.onload = function() {
                let [imgEntries] = performance.getEntriesByName(url)
                res(imgEntries)
            }
            img.onerror = function() {
                rej('å›¾ç‰‡åŠ è½½å¤±è´¥')
            }
            img.src = url
        }else{
            rej('æµè§ˆå™¨ä¸æŒæ”¯æŒperformance')
        }
    })
}
let url = 'https://images.daojia.com/changsha/banner/pic/25675a8d10bfa08e9599d2deb9a44eae.jpeg'
getImgSize(url).then(v=&gt;{
    console.log(v)
    console.log(v.decodedBodySize)
    console.log((v.decodedBodySize / 1000),'KB')
    // transferSize  åˆ¤æ–­æ˜¯å¦ç¼“å­˜
})
</code></pre>
<blockquote>
<p>è¿™å—ä½¿ç”¨ decodedBodySizeï¼Œå› ä¸º css jsç­‰èµ„æº decodedBodySize ä¸æœ¬åœ°å¤§å°ä¸€è‡´<br>
<img src="https://weidadeda.github.io/post-images/1644227863370.png" alt="" loading="lazy"><br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceResourceTiming/decodedBodySize">decodedBodySize-MDNæ–‡æ¡£</a><br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceResourceTiming/encodedBodySize">encodedBodySize-MDN æ–‡æ¡£</a><br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/getEntriesByName">performance.getEntriesByName-MDNæ–‡æ¡£</a><br>
å“ˆå“ˆå“ˆå“ˆï¼Œæˆäº†ï½</p>
</blockquote>
<h3 id="å¤šç»„æ•°æ®éªŒè¯">å¤šç»„æ•°æ®éªŒè¯</h3>
<table>
<thead>
<tr>
<th style="text-align:left">å›¾ç‰‡åœ°å€</th>
<th style="text-align:center">æœ¬åœ°size</th>
<th style="text-align:center">canvas.toBlob</th>
<th style="text-align:center">canvas.toDataURL + dataURLtoBlob</th>
<th style="text-align:center">performance</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">https://images.daojia.com/changsha/banner/pic/25675a8d10bfa08e9599d2deb9a44eae.jpeg</td>
<td style="text-align:center">20519</td>
<td style="text-align:center">36345</td>
<td style="text-align:center">36343</td>
<td style="text-align:center">20519</td>
</tr>
<tr>
<td style="text-align:left">https://images.daojia.com/dop/custom/dda52b42212b6bdea3e12d03ac97ffbe.png</td>
<td style="text-align:center">65511</td>
<td style="text-align:center">164303</td>
<td style="text-align:center">164302</td>
<td style="text-align:center">65511</td>
</tr>
<tr>
<td style="text-align:left">https://images.daojia.com/dop/custom/f8f0528c61e243699c309f5f25eab513.png</td>
<td style="text-align:center">14638</td>
<td style="text-align:center">36394</td>
<td style="text-align:center">36391</td>
<td style="text-align:center">14638</td>
</tr>
</tbody>
</table>
<h4 id="æ²¡æœ‰çœ‹é”™-performance-ä¸æœ¬åœ°çš„å®Œå…¨ä¸€æ ·">æ²¡æœ‰çœ‹é”™ performance ä¸æœ¬åœ°çš„å®Œå…¨ä¸€æ ·</h4>
<h3 id="ä¸é™åˆ¶äºå›¾ç‰‡">ä¸é™åˆ¶äºå›¾ç‰‡</h3>
<pre><code>function loadJSFile(source) {
    return new Promise((res, rej) =&gt; {
        const node = document.createElement('script')
        node.async = false
        node.src = source

        const supportOnload = 'onload' in node
        if (supportOnload) {
            node.onload = function(){
                res(this)
            }
            node.onerror = () =&gt; {
                rej(`${source}åŠ è½½å¤±è´¥`)
            }
        } else {
            node.onreadystatechange = function(){
                if (/loaded|complete/i.test(node.readyState)) {
                    res(this)
                }
            }
        }
        document.getElementsByTagName('head')[0].appendChild(node)
    })
}
function loadImgFile(url){
    return new Promise((res, rej) =&gt; {
        const img = new Image()
        img.crossOrigin = ''
        img.onload = function() {
            res(this)
        }
        img.onerror = function() {
            rej('å›¾ç‰‡åŠ è½½å¤±è´¥')
        }
        img.src = url
    })
}

function loadCSSFile(source) {
    return new Promise((res, rej) =&gt; {
        var head = document.getElementsByTagName('head')[0];
        var link = document.createElement('link');
        link.type = 'text/css';
        link.rel = 'stylesheet';
        link.href = source;
        const supportOnload = 'onload' in link
        if (supportOnload) {
            link.onload = function(){
                res(this)
            }
            link.onerror = () =&gt; {
                rej(`${source}åŠ è½½å¤±è´¥`)
            }
        } else {
            link.onreadystatechange = function(){
                if (/loaded|complete/i.test(link.readyState)) {
                    res(this)
                }
            }
        }
        head.appendChild(link);
    })
}
function getFileSize(url){
    return new Promise((res, rej) =&gt; {
    var performance = window.performance || 
        window.msPerformance || 
        window.webkitPerformance;
    if (performance) {
        let [imgEntries] = performance.getEntriesByName(url)
        if(imgEntries){
            console.log(imgEntries)
            console.log(imgEntries.decodedBodySize)
            console.log((imgEntries.decodedBodySize / 1000),'KB')
            res(imgEntries)
        }else{
            rej('èµ„æºåŠ è½½æœ‰é—®é¢˜')
        }
    }else{
        rej('æµè§ˆå™¨ä¸æŒæ”¯æŒperformance')
    }
})
}
(async function (){
    const css = 'https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css';
    await loadCSSFile(css)
    await getFileSize(css)

    const js = 'https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.min.js';
    await loadJSFile(js)
    await getFileSize(js)

    const img = 'https://images.daojia.com/dop/custom/f8f0528c61e243699c309f5f25eab513.png';
    await loadImgFile(img)
    await getFileSize(img)
})()
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://weidadeda.github.io/post-images/1644228526757.png" alt="" loading="lazy"></figure>
<h3 id="å…¼å®¹æ€§">å…¼å®¹æ€§</h3>
<p>æœ€åè®°å¾—ä½¿ç”¨<a href="https://caniuse.com/?search=encodedBodySize">caniuse - performance</a>æŸ¥çœ‹ä¸€ä¸‹å…¼å®¹æ€§</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç”¨yeomanå¼€å‘ä¸€ä¸ªè‡ªå·±çš„é¡¹ç›®è„šæ‰‹æ¶]]></title>
        <id>https://weidadeda.github.io/post/kai-fa-yi-ge-zi-ji-de-xiang-mu-jiao-shou-jia</id>
        <link href="https://weidadeda.github.io/post/kai-fa-yi-ge-zi-ji-de-xiang-mu-jiao-shou-jia">
        </link>
        <updated>2022-02-07T07:37:02.000Z</updated>
        <content type="html"><![CDATA[<p><img src="https://weidadeda.github.io/post-images/1644219568486.gif" alt="" loading="lazy"><br>
ä¸Šé¢æ˜¯ä¸€ä¸ªä½¿ç”¨è„šæ‰‹æ¶æ¥åˆå§‹åŒ–é¡¹ç›®çš„å…¸å‹ä¾‹å­ã€‚<br>
éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„ç†å¿µä¸æ–­æ·±å…¥ï¼Œè¶Šæ¥è¶Šå¤šçš„äººé€‰æ‹©ä½¿ç”¨è„šæ‰‹æ¶æ¥ä»é›¶åˆ°ä¸€æ­å»ºè‡ªå·±çš„é¡¹ç›®ã€‚å…¶ä¸­å¤§å®¶æœ€ç†Ÿæ‚‰çš„å°±æ˜¯create-react-appå’Œvue-cliï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆå§‹åŒ–é…ç½®ã€ç”Ÿæˆé¡¹ç›®ç»“æ„ã€è‡ªåŠ¨å®‰è£…ä¾èµ–ï¼Œæœ€åæˆ‘ä»¬ä¸€è¡ŒæŒ‡ä»¤å³å¯è¿è¡Œé¡¹ç›®å¼€å§‹å¼€å‘ï¼Œæˆ–è€…è¿›è¡Œé¡¹ç›®æ„å»ºï¼ˆbuildï¼‰ã€‚<br>
è¿™äº›è„šæ‰‹æ¶æä¾›çš„éƒ½æ˜¯æ™®éæ„ä¹‰ä¸Šçš„æœ€ä½³å®è·µï¼Œä½†æ˜¯æˆ‘åœ¨å¼€å‘ä¸­å‘ç°ï¼Œéšç€ä¸šåŠ¡çš„ä¸æ–­å‘å±•ï¼Œå¿…ç„¶ä¼šå‡ºç°éœ€è¦é’ˆå¯¹ä¸šåŠ¡å¼€å‘çš„å®é™…æƒ…å†µæ¥è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼š</p>
<ol>
<li>
<p>é¡¹ç›®æ¶æ„çš„é…ç½®<br>
a. webpack/gulpçš„é…ç½®<br>
â…°. style/less/sassçš„é€‰æ‹©å’Œå¤„ç†é…ç½®ã€‚<br>
â…±. Typescriptå’ŒJavaScriptçš„loaderå’Œbabelçš„é…ç½®ï¼Œæ¯”å¦‚babel-loaderå’Œtscã€‚<br>
â…². å›¾ç‰‡çš„é…ç½®ï¼Œæ¯”å¦‚éœ€è¦file-loaderæˆ–è€…url-loaderã€‚<br>
â…³. é™æ€èµ„æºçš„é…ç½®ã€‚<br>
â…´. ä¼ä¸šå†…éƒ¨ï¼ŒçœŸå¯¹äºæŸäº›ç‰¹å®šåŠŸèƒ½çš„webpack-loader/webpack-pluginï¼Œæ¯”å¦‚æ‰“åŒ…å®Œå›¾ç‰‡ä¸Šä¼ ã€‚<br>
b. æ˜¯å¦å†…ç½®ä¸€äº›ç¬¬ä¸‰æ–¹æ¡†æ¶ä¾›ä¸Šæ‰‹ä½¿ç”¨ï¼Œæ¯”å¦‚Element-UIï¼ŒAntdç­‰ã€‚<br>
c. é¡¹ç›®çš„è·¯ç”±çš„è®¾è®¡å’Œé…ç½®ã€‚<br>
d. é¡¹ç›®ç›®å½•ç»“æ„çš„è®¾è®¡å’Œé…ç½®ã€‚<br>
e. é¡¹ç›®é€šç”¨åŠŸèƒ½çš„æœ‰å…³ä»£ç ï¼Œæ¯”å¦‚ç™»é™†å’Œæ¬¢è¿é¡µç­‰ã€‚<br>
f.é€šè¿‡è°ƒæ•´æ’ä»¶ä¸é…ç½®å®ç° Webpack æ‰“åŒ…æ€§èƒ½ä¼˜åŒ–<br>
g.é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒåšçš„å•ç‹¬å¤„ç†</p>
</li>
<li>
<p>é¡¹ç›®å¼€å‘ä¸­çš„é…ç½®<br>
a. eslintã€‚<br>
b. style-lintã€‚<br>
c. prettierã€‚<br>
d. å•å…ƒæµ‹è¯•jestæˆ–è€…å…¶ä»–å•å…ƒæµ‹è¯•æ¡†æ¶ã€‚<br>
e. é¡¹ç›®æ–‡æ¡£çš„è‡ªåŠ¨ç”Ÿæˆï¼Œæ¯”å¦‚doczã€‚<br>
f. gitç›¸å…³çš„ï¼Œæ¯”å¦‚gitæäº¤çš„æ ¡éªŒï¼Œç”Ÿæˆchangelog<br>
g. npmç›¸å…³ï¼Œé™¤éæ˜¯å¼€å‘npmåŒ…ï¼Œå¦åˆ™npmç›¸å…³çš„ä¸æ˜¯é‚£ä¹ˆé‡è¦<br>
h. ä¸å¼€å‘æœ‰å…³çš„å·¥å…·ï¼Œæ¯”å¦‚æ‰“åŒ…æ„å»ºç»“æœçš„åŒ…åˆ†æã€æ¯”å¦‚ç›¸ä¼¼ä»£ç è‡ªåŠ¨ç”Ÿæˆ</p>
</li>
<li>
<p>é¡¹ç›®ä¸Šçº¿è„šæœ¬ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¯é€‰é¡¹ï¼Ÿæ›´ä¼˜çš„æ–¹æ³•åº”è¯¥æ˜¯ä½¿ç”¨å†…éƒ¨çš„ä¾‹å¦‚å‘å¸ƒå¹³å°ä¹‹ç±»çš„å·¥å…·å®Œæˆï¼Œæˆ–è€…é€šè¿‡jekinsæˆ–è€…gitlab-ciè¿›è¡Œè‡ªåŠ¨åŒ–å‘å¸ƒï¼Œå›æ»šç­‰æ“ä½œã€‚ä¸Šçº¿å‘å¸ƒå›æ»šçš„åŠ¨ä½œå¯ä»¥å®Œå…¨äº¤ç»™éå¼€å‘äººå‘˜å®Œæˆã€‚<br>
a. æ¯”å¦‚ç”±nodejsç¼–å†™çš„ä¸Šçº¿è„šæœ¬ï¼Œæˆ–è€…æ˜¯ç”¨äºä¸Šçº¿çš„shellè„šæœ¬ã€‚<br>
b. gitlab-ciçš„é…ç½®æ–‡ä»¶</p>
</li>
</ol>
<p>â€¦â€¦<br>
æ€»è€Œè¨€ä¹‹ï¼Œéšç€ä¸šåŠ¡å‘å±•ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šæ²‰æ·€å‡ºä¸€å¥—æ›´â€œä¸ªæ€§åŒ–â€çš„ä¸šåŠ¡æ–¹æ¡ˆã€‚è¿™æ—¶å€™æˆ‘ä»¬æœ€ç›´æ¥çš„åšæ³•å°±æ˜¯å¼€å‘å‡ºä¸€ä¸ªè¯¥æ–¹æ¡ˆçš„è„šæ‰‹æ¶æ¥ï¼Œä»¥ä¾¿ä»Šåèƒ½å¤ç”¨è¿™äº›æœ€ä½³å®è·µä¸æ–¹æ¡ˆã€‚<br>
é‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ä¸€ä¸ªå·¥å…·æ¥å¸®æˆ‘ä»¬åšè¿™äº›å¤„ç†ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯yomanã€‚<a href="https://yeoman.io/">å®˜ç½‘åœ°å€</a><br>
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨yeomanå’Œyeomançš„generatoræ¥æ›´åŠ ä¾¿æ·å®ç°æˆ‘ä»¬çš„è„šæ‰‹æ¶ï¼Œå¯ä»¥è¯´åŸºæœ¬æ˜¯é›¶æˆæœ¬ã€‚<br>
å…ˆè¯´è¯´Yeomanæ˜¯ä»€ä¹ˆï¼Œå®ƒæƒ³åšä»€ä¹ˆï¼Ÿ<br>
Yeamonå¸®åŠ©ä½ å¿«é€Ÿçš„å¼€å±•ä¸€ä¸ªé¡¹ç›®å·¥ç¨‹ï¼Œæä¾›æœ€ä½³å®è·µå’Œå·¥å…·ï¼Œæ¥è®©ä½ ä¿æŒé«˜æ•ˆç‡ç¼–ç ã€‚</p>
<p>ä»–ä»¬è‡ªå·±æä¾›äº†ä¸€ä¸ªæ„å»ºç”Ÿæ€ç³»ç»Ÿï¼Œä¸»è¦é€šè¿‡â€˜yoâ€™è¿™ä¸ªå‘½ä»¤æ¥æ„å»ºä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®æˆ–è€…é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>é€šè¿‡å®˜æ–¹çš„ç”Ÿæˆå™¨ï¼Œä»–ä»¬å»ºç«‹äº†ä¸€ä¸ªYeomançš„å·¥ä½œæµï¼Œè¿™ä¸ªæµæ˜¯ç”±ä¸€ä¸ªå¼ºå¤§çš„,å›ºå®šçš„å®¢æˆ·ç«¯ç»„å»ºï¼ŒåŒ…å«å·¥å…·å’Œæ¡†æ¶å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå»ºç«‹ç‰›é€¼çš„webåº”ç”¨ã€‚ä»–ä»¬å°½é‡æä¾›äº†å¼€å‘è€…æ‰€éœ€çš„ä¸œè¥¿ã€‚æ¯”å¦‚å…ˆä¸‹è½½å¯¹åº”æ¨¡ç‰ˆé¡¹ç›®ï¼Œç„¶åä¸‹è½½æ¨¡ç‰ˆé¡¹ç›®ä¸­çš„package.jsonä¸­çš„åŒ…</p>
<p>ä½œä¸ºè‰¯å¥½æ–‡æ¡£å’Œæ·±å…¥æ€è€ƒæ„å»ºè¿‡ç¨‹çš„æ€æƒ³è€…ï¼ŒYeomanåŒ…å«äº†æ£€æµ‹ï¼ˆé™æ€æ£€æµ‹ï¼‰ã€æµ‹è¯•ä»¥åŠå‹ç¼©ç­‰ç­‰ä¸€ç³»åˆ—å·¥å…·ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºæ€è€ƒè§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨ï¼š</h3>
<p>1ã€npm install -g yo //æƒé™ä¸å¤Ÿï¼Œè¯·åŠ ä¸Š sudoï¼Œä¸€èˆ¬æ¥è¯´macéƒ½éœ€è¦ã€‚<br>
å®‰è£…å®Œæˆä¹‹åï¼Œä½ å°±æ‹¥æœ‰äº†1ä¸ªå‘½ä»¤ -- yo å¯ä»¥é€‰æ‹©è‡ªå®šä¹‰çš„ï¼Œä¹Ÿå¯ä»¥æœç´¢ä½ æƒ³è¦çš„ç°æˆçš„ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©è‡ªå·±çš„ã€‚ å®˜ç½‘æä¾›çš„åœ°å€ï¼šhttp://yeoman.io/generators/<br>
é‚£æˆ‘ä»¬å¼€å§‹ç¼–å†™ä¸€ä¸ªè‡ªå·±çš„generatorsã€‚<br>
2ã€å¼€å‘è‡ªå·±çš„generator<br>
åˆ›å»ºé¡¹ç›®<br>
å…¨å±€å®‰è£…generator-generatorï¼Œç„¶åä½¿ç”¨åˆ›å»ºé¡¹ç›®ï¼Œæ ¹æ®æç¤ºè¾“å‡ºæˆ‘ä»¬çš„generatoré¡¹ç›®çš„åå­—ï¼Œyeomanè§„å®šé¡¹ç›®åå­—å¿…é¡»ä»¥generatorå¼€å¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€‰æ‹©generator-xxxä½œä¸ºæˆ‘ä»¬çš„é¡¹ç›®å<br>
npm i -g generator-generator<br>
yo generator<br>
åˆ›å»ºå¥½é¡¹ç›®ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å·²ç»è‡ªåŠ¨ä¸ºæˆ‘ä»¬é…ç½®å¥½äº†eslintï¼Œjestï¼Œhusky</p>
<p>æˆ‘ä»¬ä¸»è¦éœ€è¦ä¿®æ”¹çš„ä»£ç ä½äºgenerators/appå†…<br>
â— index.jså®šä¹‰äº†æˆ‘ä»¬ä½¿ç”¨æ­¤generatoræ—¶çš„ä¸€äº›æ“ä½œé…ç½®é¡¹<br>
â— templateså†…å­˜æ”¾çš„æ˜¯è¦ç”Ÿæˆçš„é¡¹ç›®çš„é¡¹ç›®æ¨¡æ¿ï¼Œé¡¹ç›®æ¨¡æ¿ä¹Ÿå¯ä»¥æ”¾åœ¨gitä¸Šï¼Œç„¶åé€šè¿‡download-git-repoä¸‹è½½åˆ°æœ¬åœ°<br>
éªŒè¯æˆ‘ä»¬åˆ›å»ºçš„é¡¹ç›®</p>
<ol>
<li>åœ¨å½“å‰é¡¹ç›®æ‰§è¡Œnpm linkä½¿å…¶è¢«é“¾æ¥åˆ°å…¨å±€</li>
<li>ç„¶åæ‰¾ä¸€ä¸ªç›®å½•ï¼Œç»ˆç«¯æ‰§è¡Œyoï¼Œæ­¤æ—¶ä¾¿å¯ä»¥å‘ç°æˆ‘ä»¬çš„generatorå·²ç»å‡ºç°åœ¨äº†é€‰æ‹©åˆ—è¡¨ä¸­ã€‚ç„¶åé€‰æ‹©æˆ‘ä»¬çš„generatorè¿è¡Œå³å¯ã€‚ç­‰å¾…å®Œæˆï¼Œä¼šå‘ç°æˆåŠŸçš„åˆ›å»ºäº†ä¸€ä¸ªå«åšdummyfile.txtçš„æ–‡ä»¶å¤¹ã€‚<br>
generators/app/index.js<br>
åˆå§‹åŒ–çš„æ–‡ä»¶å¦‚ä¸‹ã€‚</li>
</ol>
<pre><code>&quot;use strict&quot;;
const Generator = require(&quot;yeoman-generator&quot;);
const chalk = require(&quot;chalk&quot;);
const yosay = require(&quot;yosay&quot;);

module.exports = class extends Generator {
  prompting() {
    // Have Yeoman greet the user.
    this.log(
      yosay(
        `Welcome to the fantastic ${chalk.red(&quot;generator-rc-op&quot;)} generator!`
      )
    );

    const prompts = [
      {
        type: &quot;confirm&quot;,
        name: &quot;someAnswer&quot;,
        message: &quot;Would you like to enable this option?&quot;,
        default: true
      }
    ];

    return this.prompt(prompts).then(props =&gt; {
      // To access props later use this.props.someAnswer;
      this.props = props;
    });
  }

  writing() {
    this.fs.copy(
      this.templatePath(&quot;dummyfile.txt&quot;),
      this.destinationPath(&quot;dummyfile.txt&quot;)
    );
  }

  install() {
    this.installDependencies();
  }
};
</code></pre>
<p>ä»æ–‡ä»¶çš„å†…å®¹å¯ä»¥çœ‹å‡ºä¸»è¦æ“ä½œæ˜¯æš´éœ²å‡ºä¸€ä¸ªç»§æ‰¿è‡ªGeneratorçš„ç±»ï¼Œåœ¨ç±»çš„å†…éƒ¨å®šä¹‰äº†éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä¾›yoemanåœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨ã€‚æˆ‘ä»¬åªéœ€è¦å®Œå–„è¿™äº›æ–¹æ³•å°±å¯ä»¥äº†ã€‚</p>
<h3 id="yeomanæä¾›çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹">yeomanæä¾›çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š</h3>
<ol>
<li>initializingï¼šåˆå§‹åŒ–å¿…è¦çš„ä¾èµ–ï¼Œæˆ–è€…æ¯”å¦‚æ£€æµ‹æ–°ç‰ˆæœ¬</li>
<li>promptingï¼šç”¨æ¥å¤„ç†ç»ˆç«¯çš„äº¤äº’</li>
<li>defaultï¼šè¿™é‡ŒæŒ‡çš„æ˜¯è‡ªå·±è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯åä¸ºdefaultçš„æ–¹æ³•ï¼Œè‡ªå·±å®šä¹‰çš„æ–¹æ³•å¦‚æœä¸æƒ³è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆéœ€è¦ç¡®ä¿æ–¹æ³•åä»¥_ä¸ºå¼€å¤´ã€‚</li>
<li>writingï¼šå°†ç»è¿‡ejsæ¨¡æ¿æ¸²æŸ“åçš„å†…å®¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿã€‚</li>
<li>conflictsï¼šå‹‡äºè§£å†³å°†æ–‡ä»¶å†…å®¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿæ—¶å¯èƒ½é€ æˆçš„å†²çª</li>
<li>installï¼šå®‰è£…é¡¹ç›®çš„ä¾èµ–ï¼Œæ¯”å¦‚npm install æˆ–è€… bower install</li>
<li>endï¼šåšä¸€äº›æ”¶å°¾çš„å·¥ä½œã€‚</li>
</ol>
<p>è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å‡æ”¯æŒè¿”å›Promiseæ¥è¿›è¡Œå¼‚æ­¥æ“ä½œã€‚</p>
<h3 id="å†…ç½®å¸¸ç”¨å·¥å…·">å†…ç½®å¸¸ç”¨å·¥å…·</h3>
<p>ç»ˆç«¯äº¤äº’ï¼šå†…ç½®äº†Inquireræä¾›ç»ˆç«¯äº¤äº’<br>
æ¨¡æ¿å¡«å……ï¼šå†…ç½®äº†ejsæ¨¡æ¿<br>
æ–‡ä»¶æ“ä½œ<br>
â— this.fs.copyTplï¼šç”¨äºæ‹·è´å¹¶ä¸”æ ¹æ®æ•°æ®ä½¿ç”¨ejsæ¨¡æ¿æ¸²æŸ“æ–‡ä»¶ã€‚æ­¤å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œæºæ–‡ä»¶è·¯å¾„ï¼Œç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œä¼ ç»™ejsç”¨äºæ¸²æŸ“ç›®æ ‡é—®ä»·çš„æ•°æ®ã€‚<br>
â— this.fs.copyï¼šå°†æ–‡ä»¶ä¸›æºè·¯å¾„å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ã€‚<br>
â— this.destinationPath() ï¼šæ­¤å‡½æ•°è¿”å›æœ€ç»ˆç”Ÿæˆé¡¹ç›®çš„è·¯å¾„<br>
å…¶ä»–<br>
â— this.npmInstallï¼šå®ç°npm isntall</p>
<pre><code>// éƒ¨åˆ†ä»£ç ï¼Œå®Œæ•´ä»£ç è§æœ€ä¸‹æ–¹é“¾æ¥
writing() {
    const done = this.async();
    this.log(&quot;âš™  Finish basic configuration.&quot;, chalk.green(&quot;âœ”&quot;));
    this.log(&quot;ğŸ“‚ Generate the project template and configuration...&quot;);
    let spinner = ora({
      text: `Download the template from ${GIT_BASE}${TPL_REPOSITORY}...`,
      spinner: ORA_SPINNER
    }).start();
    this._downloadTemplate(TPL_REPOSITORY)
      .then(() =&gt; {
        spinner.stopAndPersist({
          symbol: chalk.green(&quot;   âœ”&quot;),
          text: `Finish downloading the template from ${GIT_BASE}${TPL_REPOSITORY}`
        });
        spinner = ora({
          text: `Copy files into the project folder...`,
          spinner: ORA_SPINNER
        }).start();
        const templateRoot = this.destinationPath(this.dirName, &quot;.tmp&quot;);
        this.log(`\n${templateRoot}`, &quot;templateRoot&quot;);
        const resoPath = path.resolve(templateRoot, &quot;../&quot;);
        this.log(resoPath, &quot;resoPath&quot;);
        spinner.stopAndPersist({
          symbol: chalk.green(&quot;   âœ”&quot;),
          text: `Finish copying files into the project folder`
        });
        execSync(`cp -R ${resoPath}/.tmp/* ${resoPath}`, { stdio: &quot;inherit&quot; });
        spinner = ora({
          text: `Clean tmp files and folders...`,
          spinner: ORA_SPINNER
        }).start();
        fs.removeSync(templateRoot);
        spinner.stopAndPersist({
          symbol: chalk.green(&quot;   âœ”&quot;),
          text: `Finish cleaning tmp files and folders`
        });
        // ExecSync(`rm -R ${resoPath}/.tmp`, { stdio: &quot;inherit&quot; });
        // å°†æ–°ç”Ÿæˆçš„é¡¹ç›®çš„titleæ¢æˆè‡ªå®šä¹‰çš„é¡¹ç›®åç§°
        ejs.renderFile(
          `${resoPath}/public/index.html`,
          { dirName: this.dirName },
          function(err, str) {
            // Str =&gt; è¾“å‡ºæ¸²æŸ“åçš„ HTML å­—ç¬¦ä¸²
            fs.writeFile(`${resoPath}/public/index.html`, str);
          }
        );
        // å°†æ–°ç”Ÿæˆçš„é¡¹ç›®çš„package.jsonçš„nameæ¢æˆè‡ªå®šä¹‰çš„é¡¹ç›®åç§°
        ejs.renderFile(
          `${resoPath}/package.json`,
          { dirName: this.dirName },
          function(err, str) {
            // Str =&gt; è¾“å‡ºæ¸²æŸ“åçš„ HTML å­—ç¬¦ä¸²
            fs.writeFile(`${resoPath}/package.json`, str);
          }
        );
        done();
      })
      .catch(err =&gt; this.env.error(err));
  }
</code></pre>
<h3 id="å…¶ä»–å¯èƒ½ç”¨åˆ°çš„å·¥å…·">å…¶ä»–å¯èƒ½ç”¨åˆ°çš„å·¥å…·</h3>
<p>â— oraï¼šç”¨äºåˆ›å»ºSpinnerï¼Œå³æ¯”å¦‚ä¸‹è½½æ¨¡æ¿æ–‡ä»¶æ—¶éœ€è¦å±•ç¤ºçš„laodingæ•ˆæœã€‚<br>
â— chalkï¼šç”¨äºæ‰“å°å½©è‰²çš„ä¿¡æ¯<br>
â— update-notifier<br>
â— beeper<br>
â— boxen<br>
è°ƒè¯•<br>
ç”±äºyeomanæ˜¯é€šè¿‡npmåŒ…çš„å½¢å¼è¿›è¡Œä½¿ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬å¼€å‘çš„generatoré¡¹ç›®çš„è·Ÿç›®å½•ä¸‹ï¼Œæ‰§è¡Œnpm link å°†æˆ‘ä»¬å¼€å‘çš„generatoré“¾æ¥åˆ°å…¨å±€ï¼Œè¿™æ ·æˆ‘ä»¬ç›´æ¥ä½¿ç”¨yoå‘½ä»¤æŸ¥çœ‹å¯ä»¥ä½¿ç”¨çš„generatorï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€å¼€å‘çš„generatoräº†ï¼Œå¹¶ä¸”æ˜¯å®æ—¶ç”Ÿæ•ˆçš„</p>
<h3 id="æˆ‘çš„ä»£ç æ˜¯åœ¨æœ¬åœ°çš„ç”¨çš„npm-linkæ²¡æœ‰ä¸Šä¼ åˆ°githubæˆ–npmæ­¤å¤„è´´å‡ºå…¶ä»–å¤§ä½¬çš„é¡¹ç›®ä»£ç -å¿«åŠ¨æ‰‹è¯•ä¸€ä¸‹å§~">æˆ‘çš„ä»£ç æ˜¯åœ¨æœ¬åœ°çš„ï¼Œç”¨çš„npm linkï¼Œæ²¡æœ‰ä¸Šä¼ åˆ°githubæˆ–npmï¼Œæ­¤å¤„è´´å‡ºå…¶ä»–å¤§ä½¬çš„é¡¹ç›®ä»£ç ã€‚å¿«åŠ¨æ‰‹è¯•ä¸€ä¸‹å§ï½</h3>
<p><a href="https://github.com/alienzhou/webpack-kickoff-template">æ¨¡ç‰ˆå®Œæ•´ä»£ç </a>   æ³¨æ„è¦ç»™ejså†™å…¥çš„ç©ºä½<br>
<a href="https://github.com/alienzhou/generator-webpack-kickoff">è„šæ‰‹æ¶å®Œæ•´ä»£ç </a></p>
<h3 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« ï¼š</h3>
<p><a href="https://www.yuque.com/kongdepeng/rgpm60/qrluup">å‰ç«¯è‡ªåŠ¨åŒ–å·¥å…· - yeoman</a><br>
<a href="https://zhuanlan.zhihu.com/p/66190308">å¦‚ä½•å¿«é€Ÿå¼€å‘ä¸€ä¸ªè‡ªå·±çš„é¡¹ç›®è„šæ‰‹æ¶ï¼Ÿ</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¦‚ä½•ç”¨Object.createæµ…æ‹·è´ä¸€ä¸ªå¯¹è±¡]]></title>
        <id>https://weidadeda.github.io/post/ru-he-yong-objectcreate-qian-kao-bei-yi-ge-dui-xiang</id>
        <link href="https://weidadeda.github.io/post/ru-he-yong-objectcreate-qian-kao-bei-yi-ge-dui-xiang">
        </link>
        <updated>2022-01-21T02:41:42.000Z</updated>
        <content type="html"><![CDATA[<p>// é¦–å…ˆå¾—ä»‹ç»ä¸€ä¸‹æ·±æ‹·è´å’Œæµ…æ‹·è´ï¼ˆè™½ç„¶å¤§å®¶éƒ½çŸ¥é“ï¼Œä½†æ¯•ç«Ÿå†™æ–‡ç« ï¼Œè¿˜æ˜¯å¾—ç…§é¡¾ä¸‹ä¸çŸ¥é“çš„åŒå­¦ï¼‰<br>
// å…¶æ¬¡é—®ä¸‹å¤§å®¶object.assignå±äºæµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´<br>
// Object.assign() æ–¹æ³•åªèƒ½æ‹·è´æºå¯¹è±¡çš„å¯æšä¸¾çš„è‡ªèº«å±æ€§ï¼ŒåŒæ—¶æ‹·è´æ—¶æ— æ³•æ‹·è´å±æ€§çš„ç‰¹æ€§ä»¬ï¼Œè€Œä¸”è®¿é—®å™¨å±æ€§ä¼šè¢«è½¬æ¢æˆæ•°æ®å±æ€§ï¼Œä¹Ÿæ— æ³•æ‹·è´æºå¯¹è±¡çš„åŸå‹<br>
// Object.getOwnPropertyDescriptorsæ–¹æ³•é…åˆ Object.create() æ–¹æ³•å¯ä»¥å®ç°æµ…æ‹·è´ã€‚<br>
// <code>// Object.create( // Object.getPrototypeOf(obj), // Object.getOwnPropertyDescriptors(obj) // ); //</code></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è‡ªå®šä¹‰ä¸€ä¸ªnewæ–¹æ³•]]></title>
        <id>https://weidadeda.github.io/post/zi-ding-yi-yi-ge-new-fang-fa</id>
        <link href="https://weidadeda.github.io/post/zi-ding-yi-yi-ge-new-fang-fa">
        </link>
        <updated>2022-01-20T06:36:51.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new">MDN new</a></p>
<h3 id="ä¸€-newçš„ä»‹ç»">ä¸€ã€newçš„ä»‹ç»</h3>
<p>newæ˜¯å¹²ä»€ä¹ˆçš„ï¼š</p>
<blockquote>
<p>new è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚</p>
</blockquote>
<p>ä½¿ç”¨newå¯ä»¥å°‘åšå››ä»¶äº‹æƒ…ï¼š</p>
<p>ä¸ç”¨åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œå› ä¸º new ä¼šå¸®ä½ åšï¼ˆä½ ä½¿ç”¨ã€Œthisã€å°±å¯ä»¥è®¿é—®åˆ°ä¸´æ—¶å¯¹è±¡ï¼‰ï¼›<br>
ä¸ç”¨ç»‘å®šåŸå‹ï¼Œå› ä¸º new ä¼šå¸®ä½ åšï¼ˆnew ä¸ºäº†çŸ¥é“åŸå‹åœ¨å“ªï¼Œæ‰€ä»¥æŒ‡å®šåŸå‹çš„åå­—ä¸º prototypeï¼‰ï¼›<br>
ä¸ç”¨ return ä¸´æ—¶å¯¹è±¡ï¼Œå› ä¸º new ä¼šå¸®ä½ åšï¼›<br>
ä¸è¦ç»™åŸå‹æƒ³åå­—äº†ï¼Œå› ä¸º new æŒ‡å®šåå­—ä¸º prototypeã€‚</p>
<p>new å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š</p>
<p>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›<br>
ä¸ºæ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ å±æ€§__proto__ï¼Œå°†è¯¥å±æ€§é“¾æ¥è‡³æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ ï¼›<br>
å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸ºthisçš„ä¸Šä¸‹æ–‡ ï¼›<br>
å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å›thisã€‚<br>
ï¼ˆè¯‘æ³¨ï¼šå…³äºå¯¹è±¡çš„ constructorï¼Œå‚è§ Object.prototype.constructorï¼‰</p>
<p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å¯¹è±¡éœ€è¦ä¸¤æ­¥ï¼š</p>
<p>é€šè¿‡ç¼–å†™å‡½æ•°æ¥å®šä¹‰å¯¹è±¡ç±»å‹ã€‚<br>
é€šè¿‡ new æ¥åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚<br>
åˆ›å»ºä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæŒ‡å®šå…¶åç§°å’Œå±æ€§çš„å‡½æ•°ï¼›å¯¹è±¡çš„å±æ€§å¯ä»¥æŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<p>å½“ä»£ç  new Foo(...) æ‰§è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹äº‹æƒ…ï¼š</p>
<p>ä¸€ä¸ªç»§æ‰¿è‡ª Foo.prototype çš„æ–°å¯¹è±¡è¢«åˆ›å»ºã€‚<br>
ä½¿ç”¨æŒ‡å®šçš„å‚æ•°è°ƒç”¨æ„é€ å‡½æ•° Fooï¼Œå¹¶å°† this ç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚new Foo ç­‰åŒäº new Foo()ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æŒ‡å®šå‚æ•°åˆ—è¡¨ï¼ŒFoo ä¸å¸¦ä»»ä½•å‚æ•°è°ƒç”¨çš„æƒ…å†µã€‚<br>
ç”±æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡å°±æ˜¯ new è¡¨è¾¾å¼çš„ç»“æœã€‚å¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰æ˜¾å¼è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä½¿ç”¨æ­¥éª¤1åˆ›å»ºçš„å¯¹è±¡ã€‚ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ„é€ å‡½æ•°ä¸è¿”å›å€¼ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸»åŠ¨è¿”å›å¯¹è±¡ï¼Œæ¥è¦†ç›–æ­£å¸¸çš„å¯¹è±¡åˆ›å»ºæ­¥éª¤ï¼‰<br>
ä½ å§‹ç»ˆå¯ä»¥å¯¹å·²å®šä¹‰çš„å¯¹è±¡æ·»åŠ æ–°çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œcar1.color = &quot;black&quot; è¯­å¥ç»™ car1 æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å±æ€§ colorï¼Œå¹¶ç»™è¿™ä¸ªå±æ€§èµ‹å€¼ &quot;black&quot;ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ä¼šå½±å“ä»»ä½•å…¶ä»–å¯¹è±¡ã€‚è¦å°†æ–°å±æ€§æ·»åŠ åˆ°ç›¸åŒç±»å‹çš„æ‰€æœ‰å¯¹è±¡ï¼Œä½ å¿…é¡»å°†è¯¥å±æ€§æ·»åŠ åˆ° Car å¯¹è±¡ç±»å‹çš„å®šä¹‰ä¸­ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ Function.prototype å±æ€§å°†å…±äº«å±æ€§æ·»åŠ åˆ°ä»¥å‰å®šä¹‰çš„å¯¹è±¡ç±»å‹ã€‚è¿™å®šä¹‰äº†ä¸€ä¸ªç”±è¯¥å‡½æ•°åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡å…±äº«çš„å±æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯å¯¹è±¡ç±»å‹çš„å…¶ä¸­ä¸€ä¸ªå®ä¾‹ã€‚ä¸‹é¢çš„ä»£ç å°†ä¸€ä¸ªå€¼ä¸º null çš„ color å±æ€§æ·»åŠ åˆ° car ç±»å‹çš„æ‰€æœ‰å¯¹è±¡ï¼Œç„¶åä»…åœ¨å®ä¾‹å¯¹è±¡ car1 ä¸­ç”¨å­—ç¬¦ä¸² &quot;black&quot; è¦†ç›–è¯¥å€¼</p>
<pre><code>function Car() {}
car1 = new Car();
car2 = new Car();

console.log(car1.color);    // undefined

Car.prototype.color = &quot;original color&quot;;
console.log(car1.color);    // original color

car1.color = 'black';
console.log(car1.color);   // black

console.log(car1.__proto__.color) //original color
console.log(car2.__proto__.color) //original color
console.log(car1.color)  // black
console.log(car2.color) // original color
</code></pre>
<blockquote>
<p>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ new è¿ç®—ç¬¦ï¼Œ æ„é€ å‡½æ•°ä¼šåƒå…¶ä»–çš„å¸¸è§„å‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ï¼Œ å¹¶ä¸ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ this çš„æŒ‡å‘ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
</blockquote>
<h3 id="äºŒ-è‡ªå®šä¹‰ä¸€ä¸ªnew">äºŒã€è‡ªå®šä¹‰ä¸€ä¸ªnew</h3>
<pre><code>  // æ„é€ å™¨å‡½æ•°
  let Parent = function (name, age) {
    this.name = name;
    this.age = age;
  };
  Parent.prototype.sayName = function () {
    console.log(this.name);
  };
  //è‡ªå·±å®šä¹‰çš„newæ–¹æ³•
  let newMethod = function (Parent, ...rest) {
    // 1.ä»¥æ„é€ å™¨çš„prototypeå±æ€§ä¸ºåŸå‹ï¼Œåˆ›å»ºæ–°å¯¹è±¡ï¼›
    let child = Object.create(Parent.prototype);
    // 2.å°†thiså’Œè°ƒç”¨å‚æ•°ä¼ ç»™æ„é€ å™¨æ‰§è¡Œ
    Parent.apply(child, rest);
    // 3.è¿”å›ç¬¬ä¸€æ­¥çš„å¯¹è±¡
    return child;
  };
  //åˆ›å»ºå®ä¾‹ï¼Œå°†æ„é€ å‡½æ•°Parentä¸å½¢å‚ä½œä¸ºå‚æ•°ä¼ å…¥
  const child = newMethod(Parent, 'echo', 26);
  child.sayName() //'echo';

  //æœ€åæ£€éªŒï¼Œä¸ä½¿ç”¨newçš„æ•ˆæœç›¸åŒ
  child instanceof Parent//true
  child.hasOwnProperty('name')//true
  child.hasOwnProperty('age')//true
  child.hasOwnProperty('sayName')//false
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node.js å¸¸ç”¨å·¥å…· ï¼ˆutil.inheritsï¼‰]]></title>
        <id>https://weidadeda.github.io/post/nodejs-chang-yong-gong-ju-utilinherits</id>
        <link href="https://weidadeda.github.io/post/nodejs-chang-yong-gong-ju-utilinherits">
        </link>
        <updated>2022-01-19T03:27:23.000Z</updated>
        <content type="html"><![CDATA[<p>util æ˜¯ä¸€ä¸ªNode.js æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›å¸¸ç”¨å‡½æ•°çš„é›†åˆï¼Œç”¨äºå¼¥è¡¥æ ¸å¿ƒJavaScript çš„åŠŸèƒ½ è¿‡äºç²¾ç®€çš„ä¸è¶³ã€‚</p>
<p>util.inherits<br>
util.inherits(constructor, superConstructor)æ˜¯ä¸€ä¸ªå®ç°å¯¹è±¡é—´åŸå‹ç»§æ‰¿ çš„å‡½æ•°ã€‚</p>
<p>JavaScript çš„é¢å‘å¯¹è±¡ç‰¹æ€§æ˜¯åŸºäºåŸå‹çš„ï¼Œä¸å¸¸è§çš„åŸºäºç±»çš„ä¸åŒã€‚JavaScript æ²¡æœ‰ æä¾›å¯¹è±¡ç»§æ‰¿çš„è¯­è¨€çº§åˆ«ç‰¹æ€§ï¼Œè€Œæ˜¯é€šè¿‡åŸå‹å¤åˆ¶æ¥å®ç°çš„ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬åªä»‹ç»util.inherits çš„ç”¨æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code>var util = require('util'); 
function Base() { 
    this.name = 'base'; 
    this.base = 1991; 
    this.sayHello = function() { 
    console.log('Hello ' + this.name); 
    }; 
} 
Base.prototype.showName = function() { 
    console.log(this.name);
}; 
function Sub() { 
    this.name = 'sub'; 
} 
util.inherits(Sub, Base); 
var objBase = new Base(); 
objBase.showName(); 
objBase.sayHello(); 
console.log(objBase); 
var objSub = new Sub(); 
objSub.showName(); 
//objSub.sayHello(); 
console.log(objSub);
</code></pre>
<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåŸºç¡€å¯¹è±¡Base å’Œä¸€ä¸ªç»§æ‰¿è‡ªBase çš„Subï¼ŒBase æœ‰ä¸‰ä¸ªåœ¨æ„é€ å‡½æ•° å†…å®šä¹‰çš„å±æ€§å’Œä¸€ä¸ªåŸå‹ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œé€šè¿‡util.inherits å®ç°ç»§æ‰¿ã€‚è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>base 
Hello base 
{ name: 'base', base: 1991, sayHello: [Function] } 
sub 
{ name: 'sub' }
</code></pre>
<p>æ³¨æ„ï¼šSub ä»…ä»…ç»§æ‰¿äº†Base åœ¨åŸå‹ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œè€Œæ„é€ å‡½æ•°å†…éƒ¨åˆ›é€ çš„ base å± æ€§å’Œ sayHello å‡½æ•°éƒ½æ²¡æœ‰è¢« Sub ç»§æ‰¿ã€‚</p>
<p>åŒæ—¶ï¼Œåœ¨åŸå‹ä¸­å®šä¹‰çš„å±æ€§ä¸ä¼šè¢«console.log ä½œ ä¸ºå¯¹è±¡çš„å±æ€§è¾“å‡ºã€‚å¦‚æœæˆ‘ä»¬å»æ‰ objSub.sayHello(); è¿™è¡Œçš„æ³¨é‡Šï¼Œå°†ä¼šçœ‹åˆ°ï¼š</p>
<pre><code>node.js:201 
throw e; // process.nextTick error, or 'error' event on first tick 
^ 
TypeError: Object #&lt;Sub&gt; has no method 'sayHello' 
at Object.&lt;anonymous&gt; (/home/byvoid/utilinherits.js:29:8) 
at Module._compile (module.js:441:26) 
at Object..js (module.js:459:10) 
at Module.load (module.js:348:31) 
at Function._load (module.js:308:12) 
at Array.0 (module.js:479:10) 
at EventEmitter._tickCallback (node.js:192:40)
</code></pre>
<p>è½¬è½½è‡ªhttps://www.cnblogs.com/yuwenjing0727/p/8135608.html</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Koaæ¥å£å‚æ•°æ ¡éªŒä¸è¿”å›å€¼ç»Ÿä¸€å¤„ç†]]></title>
        <id>https://weidadeda.github.io/post/koa-jie-kou-can-shu-xiao-yan-yu-fan-hui-zhi-tong-yi-chu-li</id>
        <link href="https://weidadeda.github.io/post/koa-jie-kou-can-shu-xiao-yan-yu-fan-hui-zhi-tong-yi-chu-li">
        </link>
        <updated>2022-01-18T11:03:04.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://github.com/node-modules/parameter">parameteråœ°å€</a><br>
// Koaæ¥å£å‚æ•°æ ¡éªŒä¸è¿”å›å€¼ç»Ÿä¸€å¤„ç†  å°†å‚æ•°æ ¡éªŒå˜æˆä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œæ­£ç¡®çš„è¯ç»§ç»­æ‰§è¡Œï¼Œé”™è¯¯çš„è¯æŠ›å‡ºé”™è¯¯å¼‚å¸¸ã€‚<br>
// åœ¨ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ä¸­è‡ªå®šä¹‰è¿”å›æ ¼å¼è¿™é‡Œå«ctx.DATAï¼ˆctxä¸Šè‡ªå®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡åŒ…å«codeé»˜è®¤200,msgé»˜è®¤â€˜æˆåŠŸâ€™,dataé»˜è®¤ç©ºå¯¹è±¡ï¼‰<br>
// è¿™é‡Œå¯¹é”™è¯¯å¼‚å¸¸åšäº†å¤„ç†ï¼ŒæŠ›å‡ºçš„æ˜¯å¸¦codeç ä»¥åŠä¸codeç å¯¹åº”çš„msgå’Œé”™è¯¯åŸå› dataçš„å¯¹è±¡ï¼Œæ­¤æ—¶æˆ‘ä»¬å°†é”™è¯¯ä¿¡æ¯èµ‹å€¼ç»™ctx.DATA.dataã€‚appä¸­å…ˆå†™ä¸€ä¸ªæ•è·é”™è¯¯çš„ä¸­é—´ä»¶ï¼Œè¿™æ ·æŠ›å‡ºçš„é”™è¯¯æˆ‘ä»¬èƒ½å¤Ÿæ•è·åˆ°ï¼Œç„¶åä»è¿™é‡Œæˆ‘ä»¬ç»™bodyèµ‹å€¼ï¼Œè¿™æ ·é”™è¯¯æ—¶è¿”å›çš„å°±æ˜¯codeç å’Œmessageéƒ½æœ‰çš„è¿”å›å€¼<br>
// å½“æˆåŠŸæŸ¥æ‰¾åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ•°æ®ç»™ctx.DATA.dataï¼Œé‚£ä¹ˆè¿”å›å€¼å°±æ˜¯codeç ä¸º200ï¼Œmsgä¸ºæˆåŠŸï¼Œdataä¸ºæ­£ç¡®æ•°æ®çš„å¯¹è±¡äº†ã€‚ä¸‡ä¸€å‡ºç°äº†ç™»é™†å¤±è´¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹å˜ctx.DATA.messageä¸ºç™»é™†å¤±è´¥ï¼Œæ”¹å˜codeç ç­‰</p>
<pre><code>/**
 * æ•°æ®æ ¡éªŒ
 * wikiï¼šhttps://github.com/node-modules/parameter/blob/master/example.js
 * @type {Parameter}
 */
// const { HttpError } = require('../../utils/tool/error')
const util = require('util')
// const ERROR_MSG = require('./errorMsg')
const ERROR_MSG = Object.freeze({
  // en
  // 0: 'fail',
  // 1: 'validation error',
  // 200: 'ok',
  // 400: 'invalid param',
  // 401: 'unauthorized',
  // 403: 'forbidden',
  // 404: 'not found',
  // 500: 'internal server error',
  // 503: 'service busy',

  // zh-cn
  0: 'å¤±è´¥',
  1: 'éªŒè¯ç é”™è¯¯',
  200: 'æˆåŠŸ',
  400: 'è¯·æ±‚å‡ºé”™',
  401: 'æœªæˆæƒçš„è¯·æ±‚',
  403: 'ç¦æ­¢ï¼šç¦æ­¢æ‰§è¡Œè®¿é—®',
  404: 'æ‰¾ä¸åˆ°ï¼šè¯·æ£€æŸ¥URLä»¥ç¡®ä¿è·¯å¾„æ­£ç¡®',
  500: 'æœåŠ¡å™¨çš„å†…éƒ¨é”™è¯¯',
  503: 'æœåŠ¡ä¸å¯ç”¨'
})

function CustomError(code, msg) {
  Error.call(this, '')

  this.code = code
  this.msg = msg || ERROR_MSG[code] || 'unknown error'

  this.getCodeMsg = function() {
    return {
      code: this.code,
      msg: this.msg
    }
  }
}

util.inherits(CustomError, Error)

function HttpError(code, msg) {
  if ([0, 1, 200, 400, 401, 403, 404, 500, 503].indexOf(code) &lt; 0) {
    throw Error('not an invalid http code')
  }

  CustomError.call(this, code, msg)
}

util.inherits(HttpError, CustomError)

const Parameter = require('parameter')
const parm = new Parameter()

// è‡ªå®šä¹‰æ ¡éªŒ
parm.addRule('name', function(e, v) {
  let sta = /^[a-z]$/.test(v)
  return sta || 'åªèƒ½è¾“å…¥ä¸€ä¸ªå­—æ¯'
})

// è·¯ç”±æ ¡éªŒåˆ—è¡¨
const ruleList = {
  // ç™»å½•
  'post/api/login': {
    mobile: { type: 'string', required: true },
    password: { type: 'string', required: true }
  },
  // è·å–é…ç½®
  'get/api/setting': {
    id: { type: 'string', required: true }
  },
  // ä¿å­˜é…ç½®
  'post/api/setting': {
    id: { type: 'number', required: true },
    title: { type: 'string', required: false },
    report_fix_id: { type: 'string', required: false },
    fix_url: { type: 'string', required: false },
    env: { type: 'string', required: false },
    report: { type: 'number', required: false },
    report_interval: { type: 'number', required: false }
  },
  // CICD
  'post/api/deploy': {
    name: { type: 'string', required: true },
    branch: { type: 'string', required: false },
    env: { type: 'string', required: false }
  },
  // ç”¨æˆ·è¯¦æƒ…
  'get/api/user-details': {
    user_id: { type: 'string', required: true }
  }
}

/**
 * æ ¡éªŒæ–¹æ³•
 * @param ctx
 * @param next
 * @returns {Promise&lt;void&gt;}
 */
const parameter = async (ctx, next) =&gt; {
  let errors, data
  let method = 'get'
  if (ctx.request.method === 'GET') {
    data = ctx.query
  } else {
    method = 'post'
    data = ctx.request.body
  }
  console.log(method, data)
  try {
    let name = ctx.req._parsedUrl.pathname
    errors = parm.validate(ruleList[method + name], data)
  } catch (e) {
    throw new HttpError(0, e.toString())
  }
  if (errors &amp;&amp; errors.length) {
    ctx.DATA.data = errors
    throw new HttpError(0, 'æ•°æ®æ ¡éªŒæœªé€šè¿‡')
  }
  await next()
}
module.exports = parameter
</code></pre>
<p>router.js</p>
<pre><code>// æ•°æ®æ ¡éªŒ
const router = require('koa-router')()
const parameter = require('../utils/parameter')
// project
router.get('/api/user-details', parameter, userDetail)
router.get('/api/setting', parameter, getSetting)
router.post('/api/setting', parameter, setSetting)
// common
router.post('/api/login', parameter, login)
// devops
router.post('/api/deploy', parameter, checkToken, deploy)
// swagger
router.get('/api/swagger.json', async function (ctx) {
  ctx.set('Content-Type', 'application/json')
  ctx.body = openapiSpecification
})
// index
router.get('/', index)

module.exports = router
</code></pre>
<p>app.js</p>
<pre><code>const Koa = require('koa')
const app = new Koa()
const views = require('koa-views')
const json = require('koa-json')
const favicon = require('koa-favicon')
const koaBody = require('koa-body')
const logger = require('koa-logger')
const colors = require('colors')
const { resolve } = require('path')
const { koaSwagger } = require('koa2-swagger-ui')
const mysql = require('mysql2')

const conf = require('./config')
const index = require('./routes')

// å…è®¸ä¸Šä¼ æ–‡ä»¶
app.use(
  koaBody({
    multipart: true,
    formidable: {
      maxFileSize: 1000 * 1024 * 1024 // è®¾ç½®ä¸Šä¼ æ–‡ä»¶å¤§å°æœ€å¤§é™åˆ¶
    }
  })
)

// ç½‘ç«™å›¾æ ‡
app.use(favicon(resolve(__dirname, './public', 'favicon.ico')))

// è¿”å›ç¾åŒ–json
app.use(json())

// koa-logger
app.use(logger())

// èµ„æºæ–‡ä»¶
app.use(require('koa-static')(resolve(__dirname, './public')))

// æ¨¡æ¿å¼•æ“
app.use(views(resolve(__dirname, './views'), { map: { html: 'nunjucks' } }))

// sqlç‰¹æ®Šå­—ç¬¦å¤„ç†
const toEscapeString = val =&gt; {
  return mysql.escape(val)
}
const toEscapeObject = dat =&gt; {
  for (let key in dat) {
    typeof dat[key] === 'string' &amp;&amp; (dat[key] = toEscapeString(dat[key]))
    typeof dat[key] === 'object' &amp;&amp; toEscapeObject(dat[key])
  }
  return dat
}

// åŠ å…¥cookie.getã€setåŠè‡ªå®šä¹‰è¿”å›æ ¼å¼
app.use(async (ctx, next) =&gt; {
  ctx.cookie = {
    set: (k, v, opt) =&gt; {
      opt = Object.assign({}, conf.cookieOptions, opt)
      return ctx.cookies.set(k, v, opt)
    },
    get: (k, opt) =&gt; {
      opt = Object.assign({}, conf.cookieOptions, opt)
      return ctx.cookies.get(k, opt)
    }
  }

  let msg = {
    0: 'å¤±è´¥',
    1: 'éªŒè¯ç é”™è¯¯',
    200: 'æˆåŠŸ',
    400: 'è¯·æ±‚å‡ºé”™',
    401: 'æœªæˆæƒçš„è¯·æ±‚',
    403: 'ç¦æ­¢ï¼šç¦æ­¢æ‰§è¡Œè®¿é—®',
    404: 'æ‰¾ä¸åˆ°ï¼šè¯·æ£€æŸ¥URLä»¥ç¡®ä¿è·¯å¾„æ­£ç¡®',
    500: 'æœåŠ¡å™¨çš„å†…éƒ¨é”™è¯¯',
    503: 'æœåŠ¡ä¸å¯ç”¨'
  }
  ctx.json = dat =&gt; {
    !dat.message &amp;&amp; (dat.message = msg[dat.code])
    return dat
  }

  // è‡ªå®šä¹‰è¿”å›æ ¼å¼
  ctx.DATA = {
    data: {},
    message: '',
    code: 200
  }

  // çŠ¶æ€ç»Ÿä¸€åˆ¤æ–­
  ctx.state = res =&gt; {
    return !(res &amp;&amp; res.length ? res[0] : res)
  }
  await next()
})

// swagger
app.use(
  koaSwagger({
    routePrefix: '/swagger', // host at /swagger instead of default /docs
    swaggerOptions: {
      url: '/api/swagger.json' // example path to json å…¶å®å°±æ˜¯ä¹‹åswagger-jsdocç”Ÿæˆçš„æ–‡æ¡£åœ°å€
    }
  })
)
// é”™è¯¯æ•è·
app.use((ctx, next) =&gt; {
  return next().catch(err =&gt; {
    console.log(err)
    let msg = err ? err.msg || err.toString() : 'unknown error'
    let code = err ? (err.code &gt;= 0 ? err.code : 500) : 500
    ctx.DATA.code = code
    ctx.DATA.message = msg
    ctx.body = ctx.DATA
    ctx.status =
      [200, 400, 401, 403, 404, 500, 503].indexOf(code) &gt;= 0 ? code : 200
  })
})
// routes
app.use(index.routes(), index.allowedMethods())

app.proxy = true

// koa error-handling æœåŠ¡ç«¯ã€httpé”™è¯¯
app.on('error', (err, ctx) =&gt; {
  console.error('server error', err, ctx)
})

module.exports = app
</code></pre>
<p>controllerå±‚çš„æ¥å£æ–‡ä»¶</p>
<pre><code>const resData = {
    os_type_data,
    ip_data,
    browser_data,
    channel_group_data,
    client_id_group_data,
    sortArrFormat,
    userActions
  }
  // æ­£å¸¸è¿”å›å†™æ³•ï¼Œä¸€ä¸ªä¸ªçš„å®šä¹‰å¾ˆéº»çƒ¦
  // const successData = {
  //   code: 0,
  //   data: resData,
  //   status: 'è¯·æ±‚æˆåŠŸ'
  // }
  // ctx.body = successData
  
  // ç›´æ¥æŠŠç»“æœèµ‹å€¼ï¼Œcodeç å’Œmessageä¸ç”¨ç®¡
  ctx.DATA.data = resData
  ctx.body = ctx.json(ctx.DATA)
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[KOAä¸­é—´ä»¶ä¸æ‰§è¡Œé¡ºåº]]></title>
        <id>https://weidadeda.github.io/post/koa-zhong-jian-jian-yu-zhi-xing-shun-xu</id>
        <link href="https://weidadeda.github.io/post/koa-zhong-jian-jian-yu-zhi-xing-shun-xu">
        </link>
        <updated>2022-01-18T06:59:26.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://www.itying.com/koa/article-index-id-90.html">koa2ä¸­æ–‡æ–‡æ¡£</a></p>
<h3 id="ä¸€-ä»€ä¹ˆæ˜¯koaçš„ä¸­é—´ä»¶">ä¸€ã€ä»€ä¹ˆæ˜¯Koaçš„ä¸­é—´ä»¶</h3>
<p>é€šä¿—çš„è®²ï¼šä¸­é—´ä»¶å°±æ˜¯åŒ¹é…è·¯ç”±ä¹‹å‰æˆ–è€…åŒ¹é…è·¯ç”±å®Œæˆåšçš„ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒå«åšä¸­é—´ä»¶ã€‚</p>
<p>åœ¨expressä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥è®¿é—®è¯·æ±‚å¯¹è±¡ï¼ˆrequest object (req)ï¼‰, å“åº”å¯¹è±¡ï¼ˆresponse object (res)ï¼‰, å’Œ web åº”ç”¨ä¸­å¤„ç†è¯·æ±‚-å“åº”å¾ªç¯æµç¨‹ä¸­çš„ä¸­é—´ä»¶ï¼Œä¸€èˆ¬è¢«å‘½åä¸º next çš„å˜é‡ã€‚åœ¨Koaä¸­ä¸­é—´ä»¶å’Œexpressæœ‰ç‚¹ç±»ä¼¼ã€‚</p>
<p>ä¸­é—´ä»¶çš„åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<p>æ‰§è¡Œä»»ä½•ä»£ç ã€‚<br>
ä¿®æ”¹è¯·æ±‚å’Œå“åº”å¯¹è±¡ã€‚<br>
ç»ˆç»“è¯·æ±‚-å“åº”å¾ªç¯ã€‚<br>
è°ƒç”¨å †æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</p>
<p>å¦‚æœæˆ‘çš„getã€postå›è°ƒå‡½æ•°ä¸­ï¼Œæ²¡æœ‰nextå‚æ•°ï¼Œé‚£ä¹ˆå°±åŒ¹é…ä¸Šç¬¬ä¸€ä¸ªè·¯ç”±ï¼Œå°±ä¸ä¼šå¾€ä¸‹åŒ¹é…äº†ã€‚å¦‚æœæƒ³å¾€ä¸‹åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦å†™next()</p>
<h3 id="äºŒ-koaåº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶">äºŒã€Koaåº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶ï¼š</h3>
<p>åº”ç”¨çº§ä¸­é—´ä»¶<br>
è·¯ç”±çº§ä¸­é—´ä»¶<br>
é”™è¯¯å¤„ç†ä¸­é—´ä»¶<br>
ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</p>
<h3 id="ä¸‰-ä½¿ç”¨">ä¸‰ã€ä½¿ç”¨</h3>
<ul>
<li>
<ol>
<li>asyncå’Œawait<br>
åœ¨koaä¸­ä½¿ç”¨å…³é”®è¯ async æ ‡è®°çš„å‡½æ•°æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œ<br>
åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨ await next(); å¤„ç†ä¸‹ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>app.use(async func())<br>
koaçš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œå°†ä¸€ç³»åˆ—è¦å¤„ç†çš„æ“ä½œå°è£…åˆ°ä¸€ä¸ªä¸ªå¼‚æ­¥å‡½æ•°ä¸­ï¼Œç„¶åç”¨Koaçš„å®ä¾‹appé€šè¿‡ app.use(async func()) çš„å½¢å¼è°ƒç”¨</li>
</ol>
</li>
</ul>
<p>ä¸€ä¸ªkoaåº”ç”¨ç¨‹åºå¦‚ä¸‹ï¼š</p>
<pre><code>// å¯¼å…¥koaï¼Œå’Œkoa 1.xä¸åŒï¼Œåœ¨koa2ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥çš„æ˜¯ä¸€ä¸ªclassï¼Œå› æ­¤ç”¨å¤§å†™çš„Koaè¡¨ç¤º:
const Koa = require('koa');
const app = new Koa(); // åˆ›å»ºä¸€ä¸ªKoaå¯¹è±¡è¡¨ç¤ºweb appæœ¬èº«:

// å¯¹äºä»»ä½•è¯·æ±‚ï¼Œappå°†è°ƒç”¨è¯¥å¼‚æ­¥å‡½æ•°å¤„ç†è¯·æ±‚ï¼š
app.use(async (ctx, next) =&gt; {
    await next();
    ctx.response.type = 'text/html';
    ctx.response.body = '&lt;h1&gt;Hello, koa2!&lt;/h1&gt;';
});

// åœ¨ç«¯å£3000ç›‘å¬:
app.listen(3000);
console.log('app started at port 3000...');
</code></pre>
<p>å¯ä»¥çœ‹åˆ° app.use() æ‹¬å·é‡Œé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å‡½æ•°ç”¨äº†å¼‚æ­¥ä¿®é¥°ç¬¦ async ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œåˆé€šè¿‡å…³é”®å­— await next() è°ƒç”¨ä¸‹ä¸€ä¸ªapp.useçš„å¼‚æ­¥å‡½æ•°ã€‚å¦‚æœè¿™ä¸ªå‡½æ•°æ˜¯æœ€åä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œåˆ™å†…éƒ¨ä¸éœ€è¦å†å†™await nextï¼ˆï¼‰ã€‚</p>
<h3 id="å››-koaä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº">å››ã€koaä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº</h3>
<p>Expressçš„ä¸­é—´ä»¶æ˜¯é¡ºåºæ‰§è¡Œï¼Œä»ç¬¬ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œåˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶ï¼Œå‘å‡ºå“åº”ã€‚<br>
Koaæ˜¯ä»ç¬¬ä¸€ä¸ªä¸­é—´ä»¶å¼€å§‹æ‰§è¡Œ,é‡åˆ° await next() å°±è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä¸€ç›´åˆ°æ‰§è¡Œåˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶ã€‚ç„¶åå†é€†åºæ‰§è¡Œä¸Šä¸€ä¸ªä¸­é—´ä»¶ await next() åé¢çš„ä»£ç ï¼Œä¸€ç›´åˆ°ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ await next() åé¢çš„ä»£ç æ‰§è¡Œå®Œæ¯•æ‰å‘å‡ºå“åº”ã€‚</p>
<p>koaæŠŠå¾ˆå¤šasyncå‡½æ•°ç»„æˆä¸€ä¸ªå¤„ç†é“¾ï¼Œæ¯ä¸ªasyncå‡½æ•°éƒ½å¯ä»¥åšä¸€äº›è‡ªå·±çš„äº‹æƒ…ï¼Œç„¶åç”¨await next()æ¥è°ƒç”¨ä¸‹ä¸€ä¸ªasyncå‡½æ•°ã€‚æˆ‘ä»¬æŠŠæ¯ä¸ªasyncå‡½æ•°ç§°ä¸ºmiddlewareï¼Œè¿™äº›middlewareå¯ä»¥ç»„åˆèµ·æ¥ï¼Œå®Œæˆå¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<pre><code>app.use(async (ctx, next) =&gt; {
    console.log('1'); 
    await next(); // è°ƒç”¨ä¸‹ä¸€ä¸ªmiddleware
    console.log('5')
});

app.use(async (ctx, next) =&gt; {
    console.log('2');
    await next(); // è°ƒç”¨ä¸‹ä¸€ä¸ªmiddleware
    console.log('4');
});

app.use(async (ctx, next) =&gt; {
    console.log('3');
});
</code></pre>
<p>è¾“å‡ºç»“æœï¼š 12345</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[nodeæ¥å£ç”Ÿæˆæ¥å£æ–‡æ¡£]]></title>
        <id>https://weidadeda.github.io/post/node-jie-kou-sheng-cheng-jie-kou-wen-dang</id>
        <link href="https://weidadeda.github.io/post/node-jie-kou-sheng-cheng-jie-kou-wen-dang">
        </link>
        <updated>2022-01-17T03:21:22.000Z</updated>
        <content type="html"><![CDATA[<p>å…ˆçœ‹ä¸‹æ•ˆæœ<br>
<img src="https://weidadeda.github.io/post-images/1642391805862.png" alt="" loading="lazy"><br>
è¿™é‡Œæˆ‘ç”¨çš„æ˜¯koa2+swagger</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<pre><code>// koa2-swagger-ui UIè§†å›¾ç»„ä»¶  swagger-jsdoc è¯†åˆ«å†™çš„ /***/ è½¬ json
npm install koa2-swagger-ui swagger-jsdoc --save
</code></pre>
<p><a href="https://www.npmjs.com/package/koa2-swagger-ui">koa2-swagger-ui npmåœ°å€</a> ï¼ˆåˆ›å»ºæ¥å£æ–‡æ¡£ï¼‰<br>
<a href="https://www.npmjs.com/package/swagger-jsdoc">swagger-jsdoc npmåœ°å€</a> ï¼ˆè¿™ä¸ªåº“è¯»å–å¸¦æœ‰jsdocæ³¨é‡Šçš„æºä»£ç ï¼Œå¹¶ç”ŸæˆOpenAPI (Swagger)è§„èŒƒã€‚ï¼‰<br>
<a href="https://www.jianshu.com/p/5365ef83252a">OpenAPI è§„èŒƒæ‘˜è¦</a></p>
<h3 id="é…ç½®">é…ç½®</h3>
<p>router.js</p>
<pre><code>const router = require('koa-router')() //å¼•å…¥è·¯ç”±å‡½æ•°
const swaggerJSDoc = require('swagger-jsdoc')
const path = require('path')
const swaggerDefinition = {
  openapi: '3.0.1',
    info: {
        title: 'blogé¡¹ç›®è®¿é—®åœ°å€',
        version: '1.0.0',
        description: 'API',
    },
    basePath: '/', // Base path (optional)
    tags: [
      {
        name: 'manage',
        description: 'ç®¡ç†ç³»ç»Ÿ'
      },
      {
        name: 'client',
        description: 'æ—¥å¿—ä¸ŠæŠ¥'
      }
    ],
    schemes: ['http', 'https'],
    securityDefinitions: {
    server_auth: {
      type: 'oauth2',
      description: 'ç™»å½•è´¦å·å¯†ç é‰´æƒ',
      tokenUrl: '',
      flow: 'password',
      scopes: {
        token: 'modify pets in your account'
      }
    },
    token: {
      type: 'apiKey',
      name: 'token',
      in: 'header'
    }
  }
};
const options = {
    swaggerDefinition,
    apis: [path.join(__dirname, './controllers/*.js')], // åŒ…å«ä¸Šè¿°æ³¨é‡Šçš„æ–‡ä»¶ï¼ˆï¼‰
};
const swaggerSpec = swaggerJSDoc(options)
// é€šè¿‡è·¯ç”±è·å–ç”Ÿæˆçš„æ³¨è§£æ–‡ä»¶
router.get('/swagger.json', async function (ctx) {
    ctx.set('Content-Type', 'application/json');
    ctx.body = swaggerSpec;
})
module.exports = router
</code></pre>
<p>app.js å…¥å£æ–‡ä»¶</p>
<pre><code>const swagger = require('./router')  // routerä¸­åšäº†swaggeré…ç½®
const { koaSwagger } = require('koa2-swagger-ui')

// æ¥å£æ–‡æ¡£é…ç½®
app.use(swagger.routes(), swagger.allowedMethods())
app.use(koaSwagger({
  routePrefix: '/swagger', // æ¥å£æ–‡æ¡£è®¿é—®åœ°å€
  swaggerOptions: {
    url: '/swagger.json', // example path to json å…¶å®å°±æ˜¯ä¹‹åswagger-jsdocç”Ÿæˆçš„æ–‡æ¡£åœ°å€
  }
}))
</code></pre>
<p>å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®é¡¹ç›®æ¥å£åœ°å€ + swagger ï¼Œæˆ‘çš„åœ°å€æ˜¯ http://localhost:4002/swagger</p>
<h3 id="æ³¨é‡Šç”Ÿæˆæ–‡æ¡£">æ³¨é‡Šç”Ÿæˆæ–‡æ¡£</h3>
<p>åœ¨controllerå±‚æ–‡ä»¶æ¯ä¸ªæ¥å£ä¸Šå†™æ³¨é‡Šï¼Œæ³¨é‡Šæ˜¯ä»¥@swaggerå¼€å¤´çš„ï¼Œswagger-jsdoc ä¼šè¯†åˆ«@swaggerï¼Œç„¶åè§£æä¸‹é¢çš„æ³¨é‡Šï¼Œè§£æå®Œç»™koa2-swagger-uiæ˜¾ç¤ºæˆé¡µé¢ï¼Œæ€»çš„æµç¨‹å°±æ˜¯è¿™æ ·ã€‚<br>
getæ–¹å¼</p>
<pre><code>// è·å–åšå®¢åˆ—è¡¨
/**
 * @swagger
 * /api/blog/list:
 *   get:
 *     summary: è·å–åšå®¢åˆ—è¡¨
 *     description: è·å–åšå®¢åˆ—è¡¨
 *     tags:
 *       - blogs
 *     parameters:
 *       - name: author
 *         in: query
 *         required: false
 *         description: ä½œè€…
 *         type: string
 *       - name: keyword
 *         in: query
 *         required: false
 *         description: æœç´¢å…³é”®å­—
 *         type: string
 *     responses:
 *       200:
 *         description: æˆåŠŸè·å–
 */
router.get('/list', async (ctx, next) =&gt; {
  const query = ctx.query
  let author = query.author || ''
  const keyword = query.keyword || ''

  const listData = await getList(author, keyword)
  ctx.body = new SuccessModel(listData)
})
</code></pre>
<p>postæ–¹å¼</p>
<pre><code>/**
 * @swagger
 * definitions:
 *  loginparam:
 *    properties:
 *      username:
 *        type: &quot;string&quot;
 *        default: &quot;shangsan&quot;
 *        description: ç”¨æˆ·å
 *      password:
 *        type: &quot;string&quot;
 *        default: &quot;123&quot;
 *        description: å¯†ç 
 */

/**
 * @swagger
 * components:
 *   schemas:
 *     ProjectDetail:
 *       type: object
 *       properties:
 *         id:
 *           type: integer
 *           format: int64
 *         petId:
 *           type: integer
 *           format: int64
 *         quantity:
 *           type: integer
 *           format: int32
 *         shipDate:
 *           type: string
 *           format: date-time
 */

/**
 * @swagger
 * /api/user/login:
 *   post:
 *     summary: ç™»å½•
 *     description: ç™»å½•
 *     tags:
 *       - user
 *     consumes:
 *      - application/json
 *      - application/xml
 *     produces:
 *      - application/json
 *      - application/xml
 *     parameters:
 *       - name: body
 *         in: body
 *         schema:
 *          $ref: '#/definitions/loginparam' ï¼ˆè¯·æ±‚å‚æ•°è¿™é‡Œå•ç‹¬æŠ½å‡ºï¼Œåœ¨ä¸Šé¢å®šä¹‰ï¼‰
 *     responses:
 *       200:
 *         description: å‘å¸ƒæˆåŠŸ
 *          content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/ProjectDetail'ï¼ˆè¿”å›å‚æ•°ä¹Ÿæ˜¯å•ç‹¬æŠ½å‡ºå®šä¹‰ï¼Œè¿™é‡Œæ˜¯éšä¾¿ä¸¾ä¸ªä¾‹å­ï¼‰
 *       402:
 *          description: ä¿¡æ¯å¡«å†™ä¸å…¨
 *       403:
 *          description: å‚æ•°ç±»å‹é”™è¯¯
 */

router.post('/login', async (ctx, next) =&gt; {
    // ä¸šåŠ¡é€»è¾‘
})
</code></pre>
<p>è¿”å›ç¤ºä¾‹<br>
<img src="https://weidadeda.github.io/post-images/1642412213197.png" alt="" loading="lazy"><br>
åŸºæœ¬çš„æ¥å£æ–‡æ¡£å°±ç”Ÿæˆå•¦ï¼Œå¿«è¯•ä¸€ä¸‹å§ï½</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Sequelize nodeè¿æ¥æ•°æ®åº“çš„ORM]]></title>
        <id>https://weidadeda.github.io/post/sequelize-node-lian-jie-shu-ju-ku-de-orm</id>
        <link href="https://weidadeda.github.io/post/sequelize-node-lian-jie-shu-ju-ku-de-orm">
        </link>
        <updated>2022-01-14T07:36:06.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://www.sequelize.com.cn/">Sequelize ä¸­æ–‡æ–‡æ¡£</a><br>
å¯ä»¥å…ˆçœ‹æ–‡æ¡£ï¼Œæ–‡æ¡£å¾ˆå…¨ï¼Œå®ƒçš„è¯­å¥å¸®æˆ‘ä»¬åšäº†å¾ˆå¤šå¤„ç†ï¼Œè€Œä¸”å¾ˆç²¾ç®€ï¼Œè®©æˆ‘ä»¬ä¸ç”¨æ­»è®°ç¡¬èƒŒsqlè¯­å¥ï¼Œä¹Ÿä¸ç”¨å»åº“é‡Œå»ºè¡¨ã€‚</p>
<h3 id="è¿æ¥æ•°æ®åº“">è¿æ¥æ•°æ®åº“</h3>
<pre><code>è¿æ¥åˆ°æ•°æ®åº“
è¦è¿æ¥åˆ°æ•°æ®åº“,å¿…é¡»åˆ›å»ºä¸€ä¸ª Sequelize å®ä¾‹. è¿™å¯ä»¥é€šè¿‡å°†è¿æ¥å‚æ•°åˆ†åˆ«ä¼ é€’åˆ° Sequelize æ„é€ å‡½æ•°æˆ–é€šè¿‡ä¼ é€’ä¸€ä¸ªè¿æ¥ URI æ¥å®Œæˆï¼š

const { Sequelize } = require('sequelize');

// æ–¹æ³• 1: ä¼ é€’ä¸€ä¸ªè¿æ¥ URI
const sequelize = new Sequelize('sqlite::memory:') // Sqlite ç¤ºä¾‹
const sequelize = new Sequelize('postgres://user:pass@example.com:5432/dbname') // Postgres ç¤ºä¾‹

// æ–¹æ³• 2: åˆ†åˆ«ä¼ é€’å‚æ•° (sqlite)
const sequelize = new Sequelize({
  dialect: 'sqlite',
  storage: 'path/to/database.sqlite'
});

// æ–¹æ³• 3: åˆ†åˆ«ä¼ é€’å‚æ•° (å…¶å®ƒæ•°æ®åº“)
const sequelize = new Sequelize('database', 'username', 'password', {
  host: 'localhost',
  dialect: /* é€‰æ‹© 'mysql' | 'mariadb' | 'postgres' | 'mssql' å…¶ä¸€ */
});
</code></pre>
<h3 id="å®šä¹‰æ¨¡å‹-å®šä¹‰è¡¨ç»“æ„">å®šä¹‰æ¨¡å‹ ï¼ˆå®šä¹‰è¡¨ç»“æ„ï¼‰</h3>
<pre><code>module.exports = function(sequelize, DataTypes) {
  return sequelize.define(
    'project',
    {
      id: {
        type: DataTypes.INTEGER(11),
        allowNull: false,
        primaryKey: true,
        autoIncrement: true
      },
      name: { type: DataTypes.STRING(255), allowNull: true },
      title: { type: DataTypes.STRING(255), allowNull: true },
      report_fix_id: { type: DataTypes.STRING(1000), allowNull: true },
      fix_url: { type: DataTypes.STRING(2000), allowNull: true },
      ignore_key: {
        type: DataTypes.STRING(2000),
        allowNull: true,
        comment: 'ç®€åŒ–æ‰“å°å¯¹è±¡ä¸­æ¯”è¾ƒå¤§çš„å¯¹è±¡'
      },
      env: {
        type: DataTypes.STRING(255),
        allowNull: true,
        comment: 'å“ªäº›ç¯å¢ƒèƒ½ä¸ŠæŠ¥æ—¥å¿—'
      },
      report_interval: {
        type: DataTypes.INTEGER(11),
        allowNull: true,
        comment: 'ä¸ŠæŠ¥æ—¶é—´é—´éš”'
      },
      ctime: {
        type: DataTypes.INTEGER(10),
        allowNull: true,
        get() {
          return moment
            .unix(this.getDataValue('ctime'))
            .format('YYYY/MM/DD HH:mm:ss')
        }
      },
      del: { type: DataTypes.INTEGER(1), allowNull: true, defaultValue: '0' }
    },
    {
      tableName: 'project'
    }
  )
}
</code></pre>
<h3 id="æ¨¡å‹åŒæ­¥-çœŸæ­£ä»æ•°æ®åº“åˆ›å»º">æ¨¡å‹åŒæ­¥ ï¼ˆçœŸæ­£ä»æ•°æ®åº“åˆ›å»ºï¼‰</h3>
<p>å®šä¹‰æ¨¡å‹æ—¶,ä½ è¦å‘Šè¯‰ Sequelize æœ‰å…³æ•°æ®åº“ä¸­è¡¨çš„ä¸€äº›ä¿¡æ¯. ä½†æ˜¯,å¦‚æœè¯¥è¡¨å®é™…ä¸Šä¸å­˜åœ¨äºæ•°æ®åº“ä¸­æ€ä¹ˆåŠï¼Ÿ å¦‚æœå­˜åœ¨,ä½†å…·æœ‰ä¸åŒçš„åˆ—,è¾ƒå°‘çš„åˆ—æˆ–ä»»ä½•å…¶ä»–å·®å¼‚,è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>è¿™å°±æ˜¯æ¨¡å‹åŒæ­¥çš„æ¥æº.å¯ä»¥é€šè¿‡è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°(è¿”å›ä¸€ä¸ªPromise)model.sync(options). é€šè¿‡æ­¤è°ƒç”¨,Sequelize å°†è‡ªåŠ¨å¯¹æ•°æ®åº“æ‰§è¡Œ SQL æŸ¥è¯¢. è¯·æ³¨æ„,è¿™ä»…æ›´æ”¹æ•°æ®åº“ä¸­çš„è¡¨,è€Œä¸æ›´æ”¹ JavaScript ç«¯çš„æ¨¡å‹.</p>
<p>User.sync() - å¦‚æœè¡¨ä¸å­˜åœ¨,åˆ™åˆ›å»ºè¯¥è¡¨(å¦‚æœå·²ç»å­˜åœ¨,åˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ)</p>
<h4 id="usersync-force-true-å°†åˆ›å»ºè¡¨å¦‚æœè¡¨å·²ç»å­˜åœ¨åˆ™å°†å…¶é¦–å…ˆåˆ é™¤-è¿™ä¸ªä¸è¦ç”¨ä¹Ÿæœ€å¥½åˆ«è¯•">User.sync({ force: true }) - å°†åˆ›å»ºè¡¨,å¦‚æœè¡¨å·²ç»å­˜åœ¨,åˆ™å°†å…¶é¦–å…ˆåˆ é™¤ ï¼ˆè¿™ä¸ªä¸è¦ç”¨ï¼Œä¹Ÿæœ€å¥½åˆ«è¯•ï¼‰</h4>
<p>User.sync({ alter: true }) - è¿™å°†æ£€æŸ¥æ•°æ®åº“ä¸­è¡¨çš„å½“å‰çŠ¶æ€(å®ƒå…·æœ‰å“ªäº›åˆ—,å®ƒä»¬çš„æ•°æ®ç±»å‹ç­‰),ç„¶ååœ¨è¡¨ä¸­è¿›è¡Œå¿…è¦çš„æ›´æ”¹ä»¥ä½¿å…¶ä¸æ¨¡å‹åŒ¹é….</p>
<pre><code>sequelize
  .authenticate()
  .then(() =&gt; {
    console.log('æ•°æ®åº“è¿æ¥æˆåŠŸ'.green)
    // sequelize.sync({ alter: true })
  })
  .catch(err =&gt; {
    console.log('æ•°æ®åº“è¿æ¥å¤±è´¥'.red)
  })
</code></pre>
<h3 id="åˆ›å»ºå®ä¾‹ä¿®æ”¹å†…å®¹insert">åˆ›å»ºå®ä¾‹ï¼ˆä¿®æ”¹å†…å®¹INSERTï¼‰</h3>
<p>å°½ç®¡æ¨¡å‹æ˜¯ä¸€ä¸ªç±»,ä½†æ˜¯ä½ ä¸åº”ç›´æ¥ä½¿ç”¨ new è¿ç®—ç¬¦æ¥åˆ›å»ºå®ä¾‹. ç›¸å,åº”è¯¥ä½¿ç”¨ build æ–¹æ³•ï¼š</p>
<pre><code>const jane = User.build({ name: &quot;Jane&quot; });
console.log(jane instanceof User); // true
console.log(jane.name); // &quot;Jane&quot;
</code></pre>
<p>ä½†æ˜¯,ä»¥ä¸Šä»£ç æ ¹æœ¬æ— æ³•ä¸æ•°æ®åº“é€šä¿¡(è¯·æ³¨æ„,å®ƒç”šè‡³ä¸æ˜¯å¼‚æ­¥çš„)ï¼ è¿™æ˜¯å› ä¸º build æ–¹æ³•ä»…åˆ›å»ºä¸€ä¸ªå¯¹è±¡,è¯¥å¯¹è±¡ è¡¨ç¤º å¯ä»¥ æ˜ å°„åˆ°æ•°æ®åº“çš„æ•°æ®. ä¸ºäº†å°†è¿™ä¸ªå®ä¾‹çœŸæ­£ä¿å­˜(å³æŒä¹…ä¿å­˜)åœ¨æ•°æ®åº“ä¸­,åº”ä½¿ç”¨ save æ–¹æ³•ï¼š</p>
<pre><code>await jane.save();
console.log('Jane å·²ä¿å­˜åˆ°æ•°æ®åº“!');
</code></pre>
<p>è¯·æ³¨æ„,ä»ä¸Šé¢ä»£ç æ®µä¸­çš„ await ç”¨æ³•æ¥çœ‹,save æ˜¯ä¸€ç§å¼‚æ­¥æ–¹æ³•. å®é™…ä¸Š,å‡ ä¹æ¯ä¸ª Sequelize æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„. build æ˜¯æå°‘æ•°ä¾‹å¤–ä¹‹ä¸€.</p>
<p>éå¸¸æœ‰ç”¨çš„æ·å¾„: create æ–¹æ³•<br>
Sequelizeæä¾›äº† create æ–¹æ³•,è¯¥æ–¹æ³•å°†ä¸Šè¿°çš„ build æ–¹æ³•å’Œ save æ–¹æ³•åˆå¹¶ä¸ºä¸€ä¸ªæ–¹æ³•ï¼š</p>
<pre><code>const jane = await User.create({ name: &quot;Jane&quot; });
// Jane ç°åœ¨å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼
console.log(jane instanceof User); // true
console.log(jane.name); // &quot;Jane&quot;
</code></pre>
<h3 id="ç®€å•-select-æŸ¥è¯¢">ç®€å• SELECT æŸ¥è¯¢</h3>
<p>ä½ å¯ä»¥ä½¿ç”¨ findAll æ–¹æ³•ä»æ•°æ®åº“ä¸­è¯»å–æ•´ä¸ªè¡¨ï¼š</p>
<pre><code>// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
const users = await User.findAll();
console.log(users.every(user =&gt; user instanceof User)); // true
console.log(&quot;All users:&quot;, JSON.stringify(users, null, 2));
</code></pre>
<p>ç›¸å½“äºsqlè¯­å¥</p>
<pre><code>SELECT * FROM ...
</code></pre>
<p>å—¯ï¼Œå†™ä¸€äº›å»ºè¡¨ä¸æŸ¥è¯¢çš„æµç¨‹ï¼Œç…§ç€å®˜ç½‘æŠ„ä¹Ÿæ²¡ä»€ä¹ˆæ„æ€ã€‚ä½¿ç”¨è¿™ä¸ªæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾çš„æ“ä½œæ•°æ®åº“ï¼Œä½¿æˆ‘ä»¬å†™nodeæ¥å£çš„æ—¶å€™æ•ˆç‡ç¿»å€ï½</p>
]]></content>
    </entry>
</feed>